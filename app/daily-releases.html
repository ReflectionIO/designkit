<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="utf-8" />
	<title>Reflection V2, Data Lab, Top Downloads</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<link rel="stylesheet" type="text/css" href="reflection-main-v2.css" />		
	<link rel="stylesheet" type="text/css" href="data-vis-daily-releases.css" />
	<link rel="stylesheet" href="js/vendor/jquery.mCustomScrollbar.css" />
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Source Sans Pro:400,600,700', 'Lato:400,700,400italic']
    }
  });
</script>
</head>
<body>
	<!--[if (lt IE 9)]>
      <div class="window-warning">
  			<p>Uh oh... Reflection doesn't work in this browser. &nbsp; &nbsp;<a href="http://outdatedbrowser.com/en" target="_blank">Download a compatible browser</a></p>
  		</div>
  <![endif]-->

  <header id="js-component-import--global-header" class="global-header"></header>
  
	<div id="js-component-import--panel-left" class="panel-left js-panel-left js-custom-scrollbar" data-mcs-theme="minimal-dark"></div>

	<div class="l-page-container">
		<div id="main" class="l-main" role="main">
			<div class="page-lab-base page-daily-releases grid-container theme-dark" ng-controller="DataController as dataList">
				
				<img src="images/data-lab-article-making-top-mock-data.png" alt="Sharing image of the chart" style="position: fixed; left: -999rem;" />

				<div class="grid__row">
					<div class="grid__row--heading-row__right">
	 					<div class="sharing-container">
	 						<div class="addthis_sharing_toolbox"></div>
	 					</div>
					</div>
				</div>

				<div class="data-lab-article-intro">
					<h1 class="data-lab-article-intro__heading">What is the Best Time of Year to Release a New App?</h1>
					<p class="data-lab-article-intro__paragraph">Discover the average daily downloads or revenue required to propel an app into the top 200 iOS charts and beyond. Compare categories and countries to assess the potential of acheiving a high rank in the Free, Paid or Grossing lists.</p>
				</div>

				<div class="grid__row overflow-visible">
					<div class="filters-row filters-row-main-chart js-filters-main-chart">
						<h2 class="filter-row__heading">Concentration of New App Releases: 2016</h2>			
					</div>
				</div>

				<div class="daily-releases-filters-container js-daily-releases-filters-container">
					<div class="secondary-filter secondary-filter--medium form-field--select js-secondary-filter js-dropdown-category">
						<select class="js-select-box">
					    <option value="Overall" selected>All Categories</option>
					    <option value="Business" data-access="key">Business</option>
					    <option value="Weather" data-access="key">Weather</option>
					    <option value="Utilities" data-access="key">Utilities</option>
					    <option value="Travel" data-access="key">Travel</option>
					    <option value="Sports" data-access="key">Sports</option>
					    <option value="SocialNetworking" data-access="key">Social Networking</option>
					    <option value="Reference" data-access="key">Reference</option>
					    <option value="Productivity" data-access="key">Productivity</option>
					    <option value="Photo&Video" data-access="key">Photo &amp; Video</option>
					    <option value="News" data-access="key">News</option>
					    <option value="Navigation" data-access="key">Navigation</option>
					    <option value="Music" data-access="key">Music</option>
					    <option value="Lifestyle" data-access="key">Lifestyle</option>
					    <option value="Health&Fitness" data-access="key">Health &amp; Fitness</option>
					    <option value="Games" data-access="key">Games</option>
					    <option value="Finance" data-access="key">Finance</option>
					    <option value="Entertainment" data-access="key">Entertainment</option>
					    <option value="Education" data-access="key">Education</option>
					    <option value="Books" data-access="key">Books</option>
					    <option value="Medical" data-access="key">Medical</option>
					    <option value="Newsstand" data-access="key">Newsstand</option>
					    <option value="Catalogs" data-access="key">Catalogs</option>
					    <option value="Food&Drink" data-access="key">Food &amp; Drink</option>
					    <option value="Shopping" data-access="key">Shopping</option>
						</select>
					</div>
					<span class="filter-label">In:</span>
					<div class="secondary-filter secondary-filter--medium form-field--select js-secondary-filter js-dropdown-country">
						<select class="js-select-box">
					    <option value="GB" selected>United Kingdom</option>
					    <option value="US" data-access="key">USA</option>
					    <option value="FR" data-access="key">France</option>
					    <option value="IT" data-access="key">Italy</option>
					    <option value="DE" data-access="key">Germany</option>
					    <option value="DK" data-access="key">Denmark</option>
					    <option value="CH" data-access="key">Switzerland</option>
					    <option value="ES" data-access="key">Spain</option>
					    <option value="IE" data-access="key">Ireland</option>
					    <option value="NL" data-access="key">Netherlands</option>
					    <option value="SE" data-access="key">Sweden</option>
						</select>
					</div>

					<div class="data-day-labels">
							<span>Mon</span>
							<span>Tue</span>
							<span>Wed</span>
							<span>Thu</span>
							<span>Fri</span>
							<span class="data-day-label-weekend">Sat</span>
							<span class="data-day-label-weekend">Sun</span>
					</div>
				</div>

				<div class="data-heatmap data-heatmap--downloads js-toggle-content" id="downloads">
					<ul class="data-container js-data-container">
						<li class='data-cell {{dataList.setCSSClass($index, "downloads")}}' ng-repeat="dataItem in dataList.appData" >
							<span class="data-cell-colour" style='opacity: {{dataList.getOpacity($index, "downloads")}}'>
								<!-- {{dataList.timeConverter(dataItem.date)}} -->
							</span>
							<div class="data-hover">
								<div class="data-hover__app-icon">
									<img src='{{dataList.appDetails.icon_url}}' alt='{{dataList.appDetails.name}}' />
								</div>
								<span class="data-hover__data-date">{{dataList.timeConverter(dataItem.date)}}</span>
								<span class="data-hover__data-value">{{dataItem.downloads}}</span>
							</div>
						</li>
					</ul>
				</div>

				<div class="footer-chart js-footer-chart">
					<div class="footer-chart__labels">
						<h2 class="footer-chart__week-title">Week <span class="js-week-number">1</span></h2>
						<span class="footer-chart__date js-date-value"></span>
						<h2 class="footer-chart__apps-released js-apps-released-value">-</h2>
						<span class="footer-chart__released-title">Apps Released</span>
					</div>
					<ul class="js-daily-releases-bar-chart">
						<li class="is-on"></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
						<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
						<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
						<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
						<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
						<li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
						<li></li><li></li><li></li><li></li>
					</ul>
				</div>

			</div>
		</div>
	</div>

	<script src="js/vendor/jquery-1.11.1.min.js"></script>
 	<script src="js/vendor/handlebars-v2.0.0.js"></script> <!-- static templates only -->
 	<script src="js-v2/templates/templates.js"></script> <!-- static templates only -->
 	<script src="js/vendor/modernizr.2.8.3.custom.min.js"></script>
	<script src="js/data-vis/weekly-heatmap.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.5.5/angular.min.js"></script>

	<!--[if IE 9]>
		<script src="js/vendor/jquery.mCustomScrollbar.concat.min.js"></script>
	<![endif]-->

	<div id="js-appendScriptsContainer"></div>

	<script src="js-v2/app-include-templates.js"></script> <!-- static templates only -->
  <script src="js-v2/application.js"></script>

  <script>

  	$(window).on("load", function(){

  		var reflectionApp = angular.module('reflectionApp', [])
			.controller('DataController', function($scope, $http) {
				
				var dataIndex = 0;
				var dataList = this;
				dataList.appDetails = heatmapData[dataIndex]; // from js/data-vis/weekly-heatmap.js
				dataList.appData = heatmapData[dataIndex].data;
console.log(dataList.appDetails);
				dataList.numberOfRows = dataList.appData.length / 7;
				dataList.getNumber = function(num) {
						var blankArray = new Array();
						for(var i = 0; i < num; i++) {
							blankArray.push(i);
						}
				    return blankArray;
				}

				dataList.getAppOpacity = function(listIndex, datatype) {
		    	var min, max;
		    	if(datatype == "revenue") {
			    	min = dataList.appDetails.min_max_revenue[0];
			    	max = dataList.appDetails.min_max_revenue[1];
			    } else {
			    	min = dataList.appDetails.min_max_downloads[0];
			    	max = dataList.appDetails.min_max_downloads[1];
			    }
		    	var range = max - min;
		    	var valueFromMin;
		    	if(datatype == "revenue") {
		    		valueFromMin = dataList.appData[listIndex].revenue_total - min;
		    	} else {
		    		valueFromMin = dataList.appData[listIndex].downloads - min;
		    	}
		    	var opacity = 1 / (range / valueFromMin);
		    	return opacity;
		    }

		    dataList.setCSSClass = function(listIndex, dataType) {
					var opacity = dataList.getAppOpacity(listIndex, dataType);
					if(opacity > 0.5) {
						return "is-hotter";
					}

					return "";
		    }
				
				dataList.getOpacity = function(listIndex, datatype) {
					// Heat map is purple to red
					// At 0% is purple #6d69c5 opacity 0, background #343438
					// At 50% is purple #6d69c5 opacity 1
					// Add a class above 50% to change background to red
					// At 50.01% is red #ff496a opacity 0, background #6d69c5
					// At 100% is red #ff496a opacity 1

					var opacity = dataList.getAppOpacity(listIndex, datatype);
					if(opacity <= 0.5) {
						opacity = opacity / 0.5;
					} else {
						opacity = (opacity - 0.5) / 0.5;
					}

					return opacity;
				}
			
			});

			window.angular.element(document).ready(function() {
		    window.angular.bootstrap(document, ["reflectionApp"]);
			});

		  new Page();
			
			function timeConverter(UNIX_timestamp){
			  var a = new Date(UNIX_timestamp);
			  var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
			  var year = a.getFullYear();
			  var month = months[a.getMonth()];
			  var date = a.getDate();
			  var hour = a.getHours();
			  var min = a.getMinutes();
			  var sec = a.getSeconds();
			  var time = date + ' ' + month + ' ' + year;
			  return time;
			}

			var FilterDropDown = function($domElement, chartType) {

				var $thisSelectBox = $domElement,
						$dropDownContainer = $("<ul>").addClass("form-field--select__dropdown"),
						$currentValue = $("<span>").addClass("form-field--select__box ref-icon-after--angle-down js-dropdown-trigger");

				$thisSelectBox.find('option').each(function(){
					
					var $thisOption = $(this),
							selectedClass = "";

					if($thisOption.val() != "") {

						if($thisOption.is(":selected")) {
							if($thisOption.val() != "") {
								selectedClass = "is-selected";
								$currentValue.text($thisOption.text());
							}
						}

						var accessClass = "";
						if($thisOption.data("access")) {
							accessClass = "ref-icon-after--key";
						}

						var $newListItem = $("<li>");
						$dropDownContainer.append($newListItem
																					.addClass("js-dropdown-option")
																					.addClass(selectedClass)
																					.addClass(accessClass)
																					.attr('data-value', $thisOption.attr('value'))
																					.on("click", function() {

																						// check the user role
																						// allow time for li select
																						var $this = $(this);
																						
																						var userId = getUserRole();
																						
																						if(userId != null || userId == null) {

																							if(userId == null) {
																								userId = "js/data-lab";
																							}

																							$thisSelectBox.find("option").removeAttr("selected");
																							$thisOption.attr("selected", "selected");
																							$currentValue.text($thisOption.text());
																							$dropDownContainer.toggle();
																							$thisSelectBox.parent("div").toggleClass("is-open");
																							$thisSelectBox.parent("div").removeClass("nothing-selected");
																							$dropDownContainer.find(".is-selected").removeClass("is-selected");
																							$(this).addClass("is-selected");

																							// request data based on filters
																							if(chartType == "dataOverview") {

																							}
																							
																						} else {
																							openSignUpPopup();
																						}

																					})
																					.append($("<span>").text($thisOption.text()))
																		);
					} else {
						// no option value means placeholder text before option is selected
						$currentValue.text($thisOption.text());
					}
				});

				$currentValue.on("click", function(){
					if(!$thisSelectBox.attr("disabled")) {
						var $parentDiv = $thisSelectBox.parent("div");
						if($parentDiv.hasClass("is-open")) {
							$dropDownContainer.toggle();	
							$parentDiv.toggleClass("is-open");
						} else {
							setTimeout(function(){
								if(!$parentDiv.hasClass("is-open")) {
									closeAllFilters();
								}
								var parentWidth = $parentDiv.width();
								var parentHeight = $parentDiv.height();
								$dropDownContainer.css({"min-width": parentWidth + "px"});
								$dropDownContainer.toggle();	
								$parentDiv.toggleClass("is-open");
							}, 50); // allow time for instance.closeAllFilters() to close other filters first
						}
					}
				});

				if($currentValue.text() == "") {
					$thisSelectBox.parent("div").addClass("nothing-selected");
				}

				$thisSelectBox.parent("div").append($currentValue)
																		.append($dropDownContainer);
			};

		  function closeAllFilters() {
				$('.js-secondary-filter.is-open .form-field--select__dropdown').hide();
				$('.js-secondary-filter.is-open').removeClass("is-open");
			}

			function getUserRole() {
				return null;
				// return "js/8wehfi7wro8ywe8mryow73yrnoxwyonr7tw4ox7b";
			}

			$("html").on("click", function(e){
				if(!$(e.target).hasClass("js-no-close-on-click") && !$(e.target).hasClass("js-clear-all")) {
					closeAllFilters();
				}
			});

		  $('.js-select-box').each(function() {
  			new FilterDropDown($(this), "dataOverview");
  		});

  		$(window).on("scroll", function(){  			
				if($(window).scrollTop() > 484) {
					$('.js-daily-releases-filters-container').addClass("is-fixed");
				} else {
					$('.js-daily-releases-filters-container.is-fixed').removeClass("is-fixed");
				}
				
				var rowHeight = 60;
				var offsetTopFromWindowTop = 176;
				var scrollTopValue = $(window).scrollTop();
				var dataContainerOffsetTop = $('.js-data-container').offset().top;
				var currentIndex = 1;
				if(scrollTopValue + offsetTopFromWindowTop > dataContainerOffsetTop) {
					var heightOfDataScrolled = (scrollTopValue + offsetTopFromWindowTop) - dataContainerOffsetTop;
					currentIndex = Math.floor(heightOfDataScrolled / rowHeight) + 1;
					$('.js-footer-chart').addClass("is-showing");
				} else {
					$('.js-footer-chart').removeClass("is-showing");
				}
				
				$('.js-daily-releases-bar-chart li.is-on').removeClass("is-on");
				$('.js-daily-releases-bar-chart li:nth-child(' + currentIndex + ')').addClass("is-on");
				$('.js-week-number').text(currentIndex);
				var formattedDate = timeConverter(heatmapData[0].data[currentIndex-1].date);
				$('.js-date-value').text(formattedDate);
				$('.js-apps-released-value').text(heatmapData[0].data[currentIndex-1].downloads);
  		});

		});

	</script>
</body>
</html>