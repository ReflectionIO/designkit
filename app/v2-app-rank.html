<!doctype html>
<html lang="en" class="no-js">
<head>
	<meta charset="utf-8" />
	<title>Reflection V2, App Page</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!--[if (gt IE 9)|(IEMobile)|(!IE)]><!-->
		<link rel="stylesheet" type="text/css" href="global-layout.css" /><link rel="stylesheet" type="text/css" href="reflection-main-v2.css" />
	<!--<![endif]-->
	<!--[if IE 9]>
		<link rel="stylesheet" type="text/css" href="ie9-v2-one.css" />
		<link rel="stylesheet" type="text/css" href="ie9-v2-two.css" />
	<![endif]-->
	<!--[if (lt IE 9)]>
		<script src="js/vendor/html5shiv.min.js"></script>
		<link rel="stylesheet" media="screen, projection" type="text/css" href="reflection-main-ie8.css" />
	<![endif]-->
	<link rel="stylesheet" href="js/vendor/jquery.mCustomScrollbar.css" />
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Source Sans Pro:400,600,700', 'Lato:400,700,400italic']
    }
  });
</script></head>
<body>
	<!--[if (lt IE 9)]>
      <div class="window-warning">
  			<p>Uh oh... Reflection doesn't work in this browser. &nbsp; &nbsp;<a href="http://outdatedbrowser.com/en" target="_blank">Download a compatible browser</a></p>
  		</div>
  <![endif]-->

  <header id="js-component-import--global-header" class="global-header"></header>
  
	<div id="js-component-import--panel-left" class="panel-left js-panel-left js-custom-scrollbar" data-mcs-theme="minimal-dark"></div>

	<div class="l-page-container">
		<div id="main" class="l-main" role="main">
			<div class="page-data-dashboard page-app page-app-rank-history">
				<div class="grid-container">

					<div class="page-header__app-icon-container">
						<img src="images/demo-icon-clash-of-hamsters.jpg" alt="Clash of Hamsters" />
					</div>

					<div class="page-header__app-title-links">
						<h1 class="heading-style--heading-three app-title">Clash of Hamsters <span class="app-developer-name">By <a href="v2-publisher.html">Reflection</a></span><span class="page-header__data-info-icon ref-icon-after--question whats-this-tooltip-icon js-whats-this-tooltip" data-whatsthis-title="What is Actual Data?" data-whatsthis="In the My Data section revenue and download data displayed are actual values taken from your real sales data. No-one else sees these numbers but you. The Store Data section is instead based on accurate estimates."></span></h1>
						<div class="toggle-container page-header__page-toggle filter-toggle filter-toggle--with-text filter-toggle--small">
							<div class="toggle">
								<input disabled="disabled" id="toggle--show-downloads" name="app-info" type="radio">
								<label for="toggle--show-downloads" onclick="location.replace('v2-app.html');" class="js-tooltip js-tooltip--instant js-tooltip--bottom js-tooltip--delay-remove" data-tooltip="We'll let you know when we have enough data to open up Google Play revenue &amp; download estimates for paid apps. <a href=http://localhost/designkit/app/v2-linked-accountsapp.html>Help out, link your account.</a>">
									Revenue &amp; Downloads
								</label>
							</div>
							<div class="toggle">
								<input id="toggle--show-ranks" name="app-info" checked type="radio">
								<label for="toggle--show-ranks" onclick="location.replace('v2-app-rank.html');">
									Rank History
								</label>
							</div>
							<div class="toggle">
								<input id="toggle--show-ratings" name="app-info" type="radio">
								<label for="toggle--show-ratings" onclick="location.replace('v2-app-ratings-info.html');">
									Ratings &amp; Info
								</label>
							</div>
							<div class="toggle">
								<input id="toggle--show-events" name="app-info" type="radio">
								<label for="toggle--show-events" onclick="location.replace('v2-app-events.html');">
									Events
								</label>
							</div>
						</div>
					</div>

					<div class="page-header__app-info-and-actions">
						<a href="#" class="page-header__text-link page-header__text-link--top">View in Appstore</a>
						<span class="page-header__app-price-details">Free + IAP</span>
						<span class="page-header__app-store ref-icon-before--ios">iPhone</span>
						<div>
							<button href="#" class="ref-button--secondary--small page-header_action-button">Download CSV</button>
							<button href="#" class="ref-button--secondary--small page-header_action-button">Follow App</button>
						</div>
					</div>
				</div>

				<div class="grid__row overflow-visible">
					<aside class="primary-filters-container">
						<div class="primary-filter form-field--select">
							<select class="js-select-box">
						    <option value="jan" selected>01/01/16 - 01/02/16</option>
						    <option value="feb">01/02/16 - 01/03/16</option>
						    <option value="mar">01/03/16 - 01/04/16</option>
						    <option value="apr">01/04/16 - 01/05/16</option>
							</select>
						</div>
						<div class="primary-filter form-field--select">
							<select class="js-select-box">
						    <option value="uni" selected>United Kingdom</option>
						    <option value="fra">France</option>
						    <option value="ger">Germany</option>
						    <option value="ita">Italy</option>
						    <option value="spa">Spain</option>
						    <option value="usa">USA</option>
							</select>
						</div>
						<div class="primary-filter form-field--select">
							<select class="js-select-box">
								<option value="iph" selected>iPhone</option>
						    <option value="ipa">iPad</option>						    
							</select>
						</div>
					</aside>
				</div>

				<aside class="grid-container secondary-filters-container">
					<div class="form-field--checkbox-list form-field--checkbox-list--inline">
						<ul>
							<li>
								<input type="checkbox" name="checkboxOne" id="checkboxOne" class="js-toggle-events">
								<label for="checkboxOne" class="checkboxLabel">Show Events</label>
								<label for="checkboxOne" class="checkboxLabelVisible">Show Events</label>
							</li>

							<li> <span class=""><input type="checkbox" value="on" id="gwt-uid-279" tabindex="0"><label for="gwt-uid-279" class="checkboxLabel">Cumulative</label><label for="gwt-uid-279" class="checkboxLabelVisible">Cumulative</label></span> </li>
						</ul>
					</div>
				</aside>

				<div class="grid__row chart-section">
					<ul class="tabs-content-list">
						<li class="is-active js-twin-chart-container">
							<section class="chart-container chart-container--split">
								<header class="chart-container__header">
									<h2 class="chart-heading heading-style--heading-three">Revenue</h2>
									<dl class="chart-summary">
										<div class="total-for-period-container">
											<dd class="total-for-period-title">Total for Period</dd>
											<dt class="total-for-period">$7,501,876 <span class="growth-on-last-period positive-colour"> + 100%</span></dt>
										</div>
									</dl>
								</header>
								<div class="chart" id="chart-revenue"></div>
							</section>
							<section class="chart-container chart-container--split">
								<header class="chart-container__header">
									<h2 class="chart-heading heading-style--heading-three">Downloads</h2>
									<dl class="chart-summary">
										<div class="total-for-period-container">
											<dd class="total-for-period-title">Total for Period</dd>
											<dt class="total-for-period">3,578,160 <span class="growth-on-last-period negative-colour"> - 100%</span></dt>
										</div>
									</dl>
								</header>
								<div class="chart" id="chart-downloads"></div>
							</section>
						</li>

						<li class="js-combined-chart-container">
							<section class="chart-container chart-container--single">
								<header class="chart-container__header">
									<dl class="chart-summary">
										<div class="total-for-period-container">
											<dd class="total-for-period-title">Revenue for Period</dd>
											<dt class="total-for-period">$7,501,876 <span class="growth-on-last-period positive-colour"> + 100%</span></dt>
										</div>
									</dl>
									<dl class="chart-summary">
										<div class="total-for-period-container">
											<dd class="total-for-period-title">Downloads for Period</dd>
											<dt class="total-for-period">3,578,160 <span class="growth-on-last-period positive-colour"> + 100%</span></dt>
										</div>
									</dl>
								</header>
								<div class="chart" id="chart-combined"></div>
							</section>
						</li>
					</ul>
				</div>

				<div class="grid-container">

					<aside class="chart-key-full chart-key-full--country-category">

						<div class="chart-key-full__row is-selected">
							<div class="chart-key-full__column">
								<div class="form-field--checkbox-list form-field--checkbox-list--inline form-field--checkbox-list--medium">
									<ul>
										<li>
											<input type="checkbox" name="checkboxGer" id="checkboxGer" checked="" class="js-toggle-row-off">
											<label for="checkboxGer" class="checkboxLabel">Germany</label>
											<label for="checkboxGer" class="checkboxLabelVisible">
												<div class="icon-flag-sm icon-flag--DE"></div>
												<span>Germany</span>
											</label>
										</li>
									</ul>
								</div>
							</div>
							<div class="chart-key-full__column">
								<div class="form-field--checkbox-list form-field--checkbox-list--inline">
									<ul>
										<li>
											<input type="checkbox" name="checkboxGerOverall" id="checkboxGerOverall" class="js-toggle-total-series" data-chart-index="0" data-series-index="0" checked>
											<label for="checkboxGerOverall" class="checkboxLabel">Overall Rank</label>
											<label for="checkboxGerOverall" class="checkboxLabelVisible">Overall Rank</label>
										</li>
									</ul>
								</div>
							</div>
							<div class="chart-key-full__column">
								<div class="form-field--checkbox-list form-field--checkbox-list--inline">
									<ul>
										<li>
											<input type="checkbox" name="checkboxGerCatOne" id="checkboxGerCatOne" checked="" class="js-toggle-total-series" data-chart-index="0" data-series-index="1">
											<label for="checkboxGerCatOne" class="checkboxLabel">Category 1 Rank</label>
											<label for="checkboxGerCatOne" class="checkboxLabelVisible">Category 1 Rank</label>
										</li>
									</ul>
								</div>
							</div>
							<div class="chart-key-full__column">
								<div class="form-field--checkbox-list form-field--checkbox-list--inline">
									<ul>
										<li>
											<input type="checkbox" name="checkboxGerCatTwo" id="checkboxGerCatTwo" checked="" class="js-toggle-total-series" data-chart-index="0" data-series-index="2">
											<label for="checkboxGerCatTwo" class="checkboxLabel">Category 2 Rank</label>
											<label for="checkboxGerCatTwo" class="checkboxLabelVisible">Category 2 Rank</label>
										</li>
									</ul>
								</div>
							</div>
							<div class="chart-key-full__column">
								<div class="form-field--checkbox-list form-field--checkbox-list--inline">
									<ul>
										<li>
											<input type="checkbox" name="checkboxGerCatThree" id="checkboxGerCatThree" checked="" class="js-toggle-total-series" data-chart-index="0" data-series-index="3">
											<label for="checkboxGerCatThree" class="checkboxLabel">Category 3 Rank</label>
											<label for="checkboxGerCatThree" class="checkboxLabelVisible">Category 3 Rank</label>
										</li>
									</ul>
								</div>
							</div>
							<div class="chart-key-full__column">
								<div class="form-field--checkbox-list form-field--checkbox-list--inline">
									<ul>
										<li>
											<input type="checkbox" name="checkboxGerCatFour" id="checkboxGerCatFour" checked="" class="js-toggle-total-series" data-chart-index="0" data-series-index="4">
											<label for="checkboxGerCatFour" class="checkboxLabel">Category 4 Rank</label>
											<label for="checkboxGerCatFour" class="checkboxLabelVisible">Category 4 Rank</label>
										</li>
									</ul>
								</div>
							</div>
						</div>

					</aside>

					<section class="data-table-section grid__column--three-quarters">
						<header class="data-table-section__header">
							<div class="data-table-section__filters">
								
								<!-- <label>Show Data For</label>
								<div class="secondary-filter form-field--select">
									<select class="js-select-box">								    
								    <option value="uk">United Kingdom</option>
								    <option value="ger" selected>Germany</option>
								    <option value="fra">France</option>
								    <option value="ita">Italy</option>
									</select>
								</div> -->

								<div class="toggle-container filter-toggle filter-toggle--with-text filter-toggle--small">
									<div class="toggle">
										<input id="toggle--show-overall" name="radiocategory" checked type="radio">
										<label for="toggle--show-overall">
											Overall Rank
										</label>
									</div>
									<div class="toggle">
										<input id="toggle--show-catone" name="radiocategory" type="radio">
										<label for="toggle--show-catone">
											Category 1
										</label>
									</div>
									<div class="toggle">
										<input id="toggle--show-cattwo" name="radiocategory" type="radio">
										<label for="toggle--show-cattwo">
											Category 2
										</label>
									</div>
									<div class="toggle">
										<input id="toggle--show-catthree" name="radiocategory" type="radio">
										<label for="toggle--show-catthree">
											Category 3
										</label>
									</div>
									<div class="toggle">
										<input id="toggle--show-catfour" name="radiocategory" type="radio">
										<label for="toggle--show-catfour">
											Category 4
										</label>
									</div>
								</div>

							</div>
						</header>
						<table class="ref-table ref-table--rank-history">
							<thead>
								<tr>
									<th>Date <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th>Grossing Rank <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th>Download Rank <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th class="rank-history-head-cell--revenue-downloads">Revenue <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th class="rank-history-head-cell--revenue-downloads">Downloads <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
								</tr>
							</thead>
							<colgroup>
								<col class="column-rank-history--date">
								<col class="column-rank-history--grossing-rank">
								<col class="column-rank-history--download-rank">
								<col class="column-rank-history--revenue">
								<col class="column-rank-history--downloads">
							</colgroup>
							<tbody>
								<tr>
									<td>Mon 1 Jan 2016</td>
									<td class="rank-history-data-cell--rank"><span>10</span> <span class="data-table__revenue-rank-growth positive-colour ref-icon-after--up">15</span></td>
									<td class="rank-history-data-cell--rank">25 <span class="data-table__download-rank-growth negative-colour ref-icon-after--down">15</span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-coming-soon js-tooltip js-tooltip--instant js-tooltip--delay-remove" data-tooltip="We'll let you know when we have enough data to open up Google Play revenue &amp; download estimates for paid apps. <a href=http://localhost/designkit/app/v2-linked-accountsapp.html>Help out, link your account.</a>">Coming Soon</span> <span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down negative-colour">-100%</span></td>
								</tr>
								<tr>
									<td>Tues 2 Jan 2016</td>
									<td class="rank-history-data-cell--rank"><span>10</span> <span class="data-table__revenue-rank-growth positive-colour ref-icon-after--up">15</span></td>
									<td class="rank-history-data-cell--rank">25 <span class="data-table__download-rank-growth negative-colour ref-icon-after--down">15</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down positive-colour">+100%</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down negative-colour">-100%</span></td>
								</tr>
								<tr>
									<td>Wed 3 Jan 2016</td>
									<td class="rank-history-data-cell--rank"><span>10</span> <span class="data-table__revenue-rank-growth positive-colour ref-icon-after--up">15</span></td>
									<td class="rank-history-data-cell--rank">25 <span class="data-table__download-rank-growth negative-colour ref-icon-after--down">15</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down positive-colour">+100%</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down negative-colour">-100%</span></td>
								</tr>
								<tr>
									<td>Thu 4 Jan 2016</td>
									<td class="rank-history-data-cell--rank"><span>10</span> <span class="data-table__revenue-rank-growth positive-colour ref-icon-after--up">15</span></td>
									<td class="rank-history-data-cell--rank">25 <span class="data-table__download-rank-growth negative-colour ref-icon-after--down">15</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down positive-colour">+100%</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down negative-colour">-100%</span></td>
								</tr>
								<tr>
									<td>Fri 5 Jan 2016</td>
									<td class="rank-history-data-cell--rank"><span>10</span> <span class="data-table__revenue-rank-growth positive-colour ref-icon-after--up">15</span></td>
									<td class="rank-history-data-cell--rank">25 <span class="data-table__download-rank-growth negative-colour ref-icon-after--down">15</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down positive-colour">+100%</span></td>
									<td class="rank-history-data-cell--revenue-downloads">&pound;7,501,876 <span class="data-table__rank-history-rev-down negative-colour">-100%</span></td>
								</tr>
							</tbody>
						</table>

						<table class="ref-table ref-table--rank-history">
							<thead>
								<tr>
									<th>Date <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th>Grossing Rank <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th>Download Rank <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th class="rank-history-head-cell--revenue-downloads">Revenue <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
									<th class="rank-history-head-cell--revenue-downloads">Downloads <svg version="1.1" x="0px" y="0px" viewBox="0 0 7 10" enable-background="new 0 0 7 10" xml:space="preserve" class="sort-svg"><path class="ascending" d="M0.4,4.1h6.1c0.1,0,0.2,0,0.3-0.1C7,3.9,7,3.8,7,3.7c0-0.1,0-0.2-0.1-0.3L3.8,0.1C3.7,0,3.6,0,3.5,0C3.4,0,3.3,0,3.2,0.1L0.1,3.3C0,3.4,0,3.5,0,3.7C0,3.8,0,3.9,0.1,4C0.2,4.1,0.3,4.1,0.4,4.1z"></path><path class="descending" d="M6.6,5.9H0.4c-0.1,0-0.2,0-0.3,0.1C0,6.1,0,6.2,0,6.3c0,0.1,0,0.2,0.1,0.3l3.1,3.2C3.3,10,3.4,10,3.5,10c0.1,0,0.2,0,0.3-0.1l3.1-3.2C7,6.6,7,6.5,7,6.3C7,6.2,7,6.1,6.9,6C6.8,5.9,6.7,5.9,6.6,5.9z"></path></svg></th>
								</tr>
							</thead>
							<colgroup>
								<col class="column-rank-history--date">
								<col class="column-rank-history--grossing-rank">
								<col class="column-rank-history--download-rank">
								<col class="column-rank-history--revenue">
								<col class="column-rank-history--downloads">
							</colgroup>
							<tbody class="ref-table__body--loading">
								<tr>
									<td><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads"> <span class="data-table__rank-history-rev-down"></span></td>
								</tr>
								<tr>
									<td><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads"> <span class="data-table__rank-history-rev-down"></span></td>
								</tr>
								<tr>
									<td><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads"> <span class="data-table__rank-history-rev-down"></span></td>
								</tr>
								<tr>
									<td><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads"> <span class="data-table__rank-history-rev-down"></span></td>
								</tr>
								<tr>
									<td><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads"> <span class="data-table__rank-history-rev-down"></span></td>
								</tr>
								<tr>
									<td><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--rank"><span></span><span></span></td>
									<td class="rank-history-data-cell--revenue-downloads"><span class="data-table__rank-history-rev-down"></span></td>
									<td class="rank-history-data-cell--revenue-downloads"> <span class="data-table__rank-history-rev-down"></span></td>
								</tr>
							</tbody>
						</table>
					</section>

					<aside class="data-aside-bar grid__column--one-quarter">

		 					<div class="summary-widget-container">
		 						<aside class="summary-widget summary-widget--highest-lowest">
		 							<h2 class="widget-title">Ranking Highs and Lows</h2>
			 						<div class="toggle-container filter-toggle filter-toggle--with-text">
										<div class="toggle">
											<input id="toggle--show-popxs" name="radioxsmall" checked type="radio">
											<label for="toggle--show-popxs">
												Grossing
											</label>
										</div>
										<div class="toggle">
											<input id="toggle--show-regxs" name="radioxsmall" type="radio">
											<label for="toggle--show-regxs">
												Download
											</label>
										</div>
									</div>

									<div class="summary-widget--highest-lowest__data-item">
										<h2 class="summary-widget--highest-lowest__data-heading">Highest Rank</h2>
										<svg enable-background="new 0 0 25 30"viewBox="0 0 25 30"x=0px xml:space=preserve y=0px><path d="M1.5,27.5c-0.5-0.3-1-0.7-1.5-1V9.9h0V0l1.2,0.9c3.6,2.6,5.7,1.6,8.2,0.5c2.1-0.9,4.6-2,8-0.6L17.8,1v5.5
    c-0.7,0.2-1.3,0.5-1.9,0.8c-1.2,0.5-2.2,1-3.3,1c-1,0-2.1-0.4-3.4-1.4L5.7,4.2v9.9c-1.2-0.1-2.6-0.5-4.2-1.1V27.5z M8.7,30v-9.8
    c2.2,0.8,4,1.1,5.5,1.1c1.9,0,3.3-0.5,4.7-0.9c1.7-0.5,3.1-1,5.2-0.6L25,20V8.1l-0.5-0.2c-3.4-1.4-5.8-0.3-8,0.6
    c-2.5,1.1-4.6,2-8.2-0.5L7.2,7.1v12.5l0,0v10.2C7.7,29.9,8.2,30,8.7,30z"fill="#C4C7D0 "/></svg>
										<div>
											<div class="summary-widget--highest-lowest__country js-tooltip js-tooltip--instant" data-tooltip="United Kingdom, USA, France">3 Countries</div>
											<span class="summary-widget--highest-lowest__rank">1</span><span class="summary-widget--highest-lowest__category">All Categories</span>
										</div>
									</div>

									<div class="summary-widget--highest-lowest__data-item">
										<h2 class="summary-widget--highest-lowest__data-heading">Biggest Climber</h2>
										<svg class="svg-icon-out-of-rank enable-background="new 0 0 32 32" viewBox="0 0 32 32" x="0px" xml:space=preserve y=0px><path d="M16,0C7.2,0,0,7.2,0,16c0,8.8,7.2,16,16,16s16-7.2,16-16C32,7.2,24.8,0,16,0z M2,16c0-3.4,1.3-6.6,3.3-9
l4.6,4.6H5.4v11.8h16.4l3.3,3.3c-2.4,2.1-5.6,3.3-9,3.3C8.3,30,2,23.7,2,16z M12.6,14.3l6.6,6.6v1.3h-6.6V14.3z M19.8,18.6v-3.4h5.2
v6.9h-1.8L19.8,18.6z M19.2,14.6v0.7V18l-6.6-6.6V9h6.6V14.6z M12,13.6v8.5H6.7v-9.2h4.6L12,13.6z M26.5,25.3l-1.9-1.9h1.8v-9.5
h-5.9V7.7h-9.2v2.4L6.7,5.5C9.2,3.3,12.4,2,16,2c7.7,0,14,6.3,14,14C30,19.6,28.7,22.8,26.5,25.3z" fill="#C4C7D0" /></svg>
										<div>
											<div class="summary-widget--highest-lowest__country">Out of Rank</div>
											<span class="summary-widget--highest-lowest__rank" style="display: none"></span><span class="summary-widget--highest-lowest__category">No Data Available</span>
										</div>
									</div>

									<div class="summary-widget--highest-lowest__data-item">
										<h2 class="summary-widget--highest-lowest__data-heading">Lowest Rank</h2>
										<div class="icon-flag icon-flag--CN"></div>
										<div>
											<a href="#" class="summary-widget--highest-lowest__country">China</a>
											<span class="summary-widget--highest-lowest__rank">145</span><span class="summary-widget--highest-lowest__category">All Categories</span>
										</div>
									</div>

									<div class="summary-widget--highest-lowest__data-item">
										<h2 class="summary-widget--highest-lowest__data-heading">Biggest Faller</h2>
										<div class="icon-flag icon-flag--FR"></div>
										<div>
											<a href="#" class="summary-widget--highest-lowest__country">France</a>
											<span class="summary-widget--highest-lowest__rank negative-colour ref-icon-after--down">32</span><span class="summary-widget--highest-lowest__category negative-colour">All Categories</span>
										</div>
									</div>

								</div>
		 					</div>
					</aside>

				</div>
			</div>			
			
		</div>

		<div class="grid-container" id="js-component-import--global-footer"></div>
	</div>	

	<div id="js-component-import--account-container" class="panel-right-container js-account-container"></div>
	<div id="js-component-import--search-container" class="panel-right-container js-search-container"></div>

 	<script src="js/vendor/jquery-1.11.1.min.js"></script>
 	<script src="js/vendor/handlebars-v2.0.0.js"></script> <!-- static templates only -->
 	<script src="js-v2/templates/templates.js"></script> <!-- static templates only -->
 	<script src="js/vendor/modernizr.2.8.3.custom.min.js"></script>

	<!--[if IE 9]>
		<script src="js/vendor/jquery.mCustomScrollbar.concat.min.js"></script>
	<![endif]-->

	<div id="js-appendScriptsContainer"></div>

	<script src="js-v2/app-include-templates.js"></script> <!-- static templates only -->
  <script src="js-v2/application.js"></script>

  <script src="js/vendor/snap.svg.js"></script> <!-- snap used for animating event flags on charts -->
  <script src="js/vendor/highcharts-custom.js"></script>
  <script src="js/vendor/highslide-software/rounded-corners.js"></script>
  <script src="js/data-vis/data-vis-release.js"></script> <!-- mock data -->
  <script>
  	// Utility function
		Date.prototype.addHours= function(h){
      this.setHours(this.getHours()+h);
      return this;
    }

  	function initScripts() {
  		// mock menu select
  		var thisPageLink = $('#js-component-import--panel-left').find('a[href="v2-data-template.html"]');
		  thisPageLink.parent("li").addClass("is-selected").parents("li").addClass("is-selected is-open");

  		new Page();
  		new AllDropDowns();
  		;
  		$('.js-select-box').each(function() {
  			new FormFieldSelect($(this));
  		});
  		$('.js-multi-select-box').each(function() {
  			new FormFieldMultipleSelect($(this));
  		});
  		$('.js-tabs').each(function() {
  			new Tabs($(this));
  		});

  		new TooltipsBase();
  		$('.js-tooltip').each(function(){
  			new ToolTip($(this));
  		});

  		// Mock function for template
  		$('#topAppsDownloads').hide();
  		$('.js-mock-switch-revenue').on("click", function(){
  			$('#topAppsDownloads').hide();
  			$('#topAppsRevenue').show();
  		});
  		$('.js-mock-switch-downloads').on("click", function(){
  			$('#topAppsDownloads').show();
  			$('#topAppsRevenue').hide();
  		});

  		$('.js-whats-this-tooltip').each(function(){
  			new WhatsThisPopup($(this));
  		});

  		$('.js-mock-remove-row').on("click", function(e){
  			e.preventDefault();
  			$(this).parents('.chart-key-full__row').remove();
  		});

  		// chart toggles
  		$('.js-mock-show-split-chart').on("click", function(){
  			
  			$('.js-toggle--show-stacked.is-disabled').removeClass("is-disabled")
																							.siblings("input").removeAttr("disabled", "disabled");
				$('.js-toggle--show-bar.is-disabled').removeClass("is-disabled")
																							.siblings("input").removeAttr("disabled", "disabled");

  			$('.js-twin-chart-container').addClass("is-active");
  			$('.js-combined-chart-container').removeClass("is-active");
  			Highcharts.charts[0].reflow(); // reflow in case of window width change before making visible again
  			Highcharts.charts[1].reflow();
  		});

  		$('.js-mock-show-single-chart').on("click", function(){
  			if(!$(this).hasClass("is-disabled")) {

					$('.js-toggle--show-stacked').addClass("is-disabled")
																				.siblings("input").attr("disabled", "disabled");

  				$('.js-twin-chart-container').removeClass("is-active");
	  			$('.js-combined-chart-container').addClass("is-active");
	  			Highcharts.charts[2].reflow();
  			}
  		});

  		// HIGHCHARTS
  		var monthNames = [
        "Jan", "Feb", "Mar",
        "Apr", "May", "Jun", "Jul",
        "Aug", "Sep", "Oct",
        "Nov", "Dec"
      ];

      var hasBeenSet = false,
      		lastPoint;

	    (function (H) {

	      var customIconRect;
	      H.wrap(H.Tooltip.prototype, 'refresh', function (proceed) {

	        proceed.apply(this, Array.prototype.slice.call(arguments, 1));

	        if(this.chart.customIconRect !== undefined) {
	          this.chart.customIconRect.destroy();
	        }

	        var $axisLabel = $(this.chart.container).find('.highcharts-axis-label'),
	            leftOffset = 29,
	            axisLabelYPos = $("#" + arguments[1][0].series.chart.container.id + "").height() - arguments[1][0].series.xAxis.bottom,
	            //axisLabelYPos = arguments[1][0].series.chart.containerHeight - arguments[1][0].series.xAxis.bottom,
	            axisLabelXPos = arguments[1][0].plotX - leftOffset,
	            timeStampString = arguments[1][0].x + "",
	            timeStampString = timeStampString.substring(0,10),
	            xAxisDate = new Date(timeStampString*1000).addHours(12),
	            formattedDate = xAxisDate.getDate() + " " + monthNames[xAxisDate.getMonth()];

	        if($axisLabel.length > 0) {       

	          var labelYPos = axisLabelYPos + 18,
	              labelXPos = axisLabelXPos + 7;

	          $axisLabel.attr("transform", "translate(" + labelXPos + "," + labelYPos + ")");
	          $axisLabel.find("text").text(formattedDate);

	        } else {
	          this.chart.renderer.label(formattedDate, axisLabelXPos+7, axisLabelYPos + 18, 'callout', 0, 0, false, true, "axis-label")
	          .css({
	            color: '#fcfdfd',
	            fontSize: '12px',
	            fontFamily: 'Source Sans Pro',
	            fontWeight: 600
	          })
	          .attr({
	            zIndex: 100
	          })
	          .add();
	        }

	        this.chart.customIconRect = this.chart.renderer.image('images/axis-label-background.png', axisLabelXPos, axisLabelYPos + 4, 54, 20)
	        .attr({
	          zIndex: 99
	        })
	        .add();


	        // Mirror the tooltip on twin charts
	        if(H.charts.length > 1) {
	        
	        	var chartIndexToHover = (arguments[1][0].series.chart.index == 0) ? 1 : 0;
	        	
	        	if(chartIndexToHover < 2) { // using twin chart to want to mirror the tooltip
	        		
	        		// find line index of currently selected line
		        	var seriesIndexToHover = 0;
		        	$.each(H.charts[chartIndexToHover].series, function(key, series){
		        		if(series.selected) {
		        			seriesIndexToHover = key;
		        		}
		        	});

		        	// set the hover on the other graph
		        	var pointIndex = arguments[1][0].index;
		        	if(!hasBeenSet) {
		        		hasBeenSet = true;
		        		// not sure why this if statement is here but there must have been an associated bug
		        		// could try removing to see if there is any lasting effect
		        		if(lastPoint) {
		        			if(H.charts[chartIndexToHover].series[seriesIndexToHover].data[lastPoint] != undefined) { // check if data series are present on the chart
		        				H.charts[chartIndexToHover].series[seriesIndexToHover].data[lastPoint].setState();
	            			H.charts[chartIndexToHover].tooltip.hide();
		        			}		        			
		        		}
		        		lastPoint = pointIndex;
								var arrayOfPointsToHover = [];
								for(var s = 0; s < H.charts[chartIndexToHover].series.length; s++) {
									if(Highcharts.charts[chartIndexToHover].series[s].visible) {
										arrayOfPointsToHover.push(H.charts[chartIndexToHover].series[s].points[pointIndex]);
									}								
								}
		        		H.charts[chartIndexToHover].tooltip.refresh(arrayOfPointsToHover);
			        		
			        	setTimeout(function(){
			        		hasBeenSet = false;
			        	}, 10);
			        }
	        	}
	        }

	        // Add Event Labels
	        	// destroy any existing labels
	        var thisPlotX = arguments[1][0].plotX,
	        		eventTooltip;

	        		if(this.chart.eventTooltips) {
	        			for (var t = 0; t < this.chart.eventTooltips.length; t++) {
	        				this.chart.eventTooltips[t].destroy();
	        			}
	        		}
	        		this.chart.eventTooltips = [];

	        	// remove existing animating CSS class for icons
	        $(".event-icon--launch.is-animating").each(function() {
	        	$(this).attr("class", "event-icon--launch");
	        });
	        $(".event-icon--flag.is-animating").each(function() {
	        	$(this).attr("class", "event-icon--flag");
	        });
	        
        	// create tooltip on event hover
        	var eventsCounter = 0,
	        			previousEventPlotX;
	        			window.animatingFlags = false;

	        if(this.chart.refEvents) {
			      for (var e = 0; e < this.chart.refEvents.length; e++) {
			      	if(this.chart.refEvents[e].plotX == thisPlotX) {
			      		// check if previous event plotX is the same as this plotX, to calculate event details label spacing
			      		if(previousEventPlotX) {
			      			if(previousEventPlotX == this.chart.refEvents[e].plotX) {
			      				eventsCounter++;
			      			} else {
			      				eventsCounter = 0;
			      			}
			      		}
			      		
			      		previousEventPlotX = this.chart.refEvents[e].plotX;
			      		var eventLabelOffset = 80;
			      		if(parseInt(previousEventPlotX) < 100) {
			      			eventLabelOffset = 30;
			      		}
			      		var labelTopSpace = axisLabelYPos + 29 + (eventsCounter * 57);
			      		var eventIcon = this.chart.refEvents[e].icon.element;
			        	eventTooltip = this.chart.renderer.label($(eventIcon).data("tooltip"), this.chart.series[0].data[$(eventIcon).data("datapoint")].plotX - eventLabelOffset, labelTopSpace, 'callout')
			            .css({
			                color: $(eventIcon).data("tooltipcolour")
			            })
			            .attr({
			            		width: 139,
			                fill: $(eventIcon).data("tooltipfill"),
			                padding: 10,
			                r: 5,
			                zIndex: 6
			            })
			            .addClass("chart-event-label")
			            .add();

			         	this.chart.eventTooltips.push(eventTooltip);

			         	// add event icon animate CSS class
			         	var currentCSSClass = $(this.chart.refEvents[e].icon.element).attr("class");
		      			$(this.chart.refEvents[e].icon.element).attr("class", "is-animating " + currentCSSClass);
		      			if(currentCSSClass.indexOf("event-icon--flag") > -1) {
		      				this.chart.refEvents[e].flag = null;
			      			window.animatingFlags = true;
			      			animateSquash = function(flagToAnimate) {
		      					flagToAnimate.animate({width: 15}, 100, function(){
		      						flagToAnimate.animate({width: 18}, 100, function() {
		      							if(window.animatingFlags) {
		      								animateSquash(flagToAnimate);
		      							}      							
		      						});
		      					});
			      			}
			      			animateSquash(Snap(this.chart.refEvents[e].icon.element)); // makes the flag "flap" (uses snap.js)
		      			}
			        }
			      }
			    }
	      });

				H.wrap(H.Series.prototype, 'hide', function (proceed) {

				  // Before the hide function
				  var t = $(this),
				  				par;

				  if(t[0].type == "area") {
				  	if(this.graph != undefined) {
				  		par = $(this.graph.element).parents('.highcharts-series').attr("class", "highcharts-series is-transparent-fade");
				  	}				  	
				  }

				  var instance = this;
				
				  setTimeout(function() {
				  	proceed.apply(instance, Array.prototype.slice.call(arguments, 1));
				  	if(t[0].type == "area" && par != undefined) {
				  		par.attr("class", "highcharts-series");
				  	}
				  }, 200);
				});

				H.Chart.prototype.animateSelectedLines = function(containerId, indexToSelect, previousSelectedIndex) {
	    		$(containerId + ' .highcharts-series path:nth-child(2)').each(function(){
	          var $this = $(this);
	          if($this.attr("data-index") == indexToSelect) {
	            $this.css("opacity", "0.3");
	            $this.animate({ "opacity": 1 }, 250);
	            $this.siblings("path").css("opacity", "0");
	            $this.siblings("path").animate({ "opacity": 1 }, 250);

	          } else if($this.attr("data-index") == previousSelectedIndex) {
	          	$this.css("opacity", 1);
	            $this.animate({ "opacity": 0.3 }, 250);
	            $this.siblings("path").css("opacity", 1);
	            $this.siblings("path").animate({ "opacity": 0 }, 250);
	          }
	        });
	    	}

	    	H.Chart.prototype.setSeriesToSelected = function(chartIndex, seriesIndex) {
	    		H.charts[chartIndex].series[seriesIndex].selected = true;
	    		if(H.charts[chartIndex].series[seriesIndex].graph) {
	    			H.charts[chartIndex].series[seriesIndex].graph.element.setAttribute("data-selected", "selected");
	    		}	      	
	    	}

	    	H.Chart.prototype.setSeriesToUnselected = function(chartIndex, seriesIndex) {
	    		$('.chart[data-highcharts-chart="' + chartIndex + '"] .highcharts-series path[data-selected]').removeAttr("data-selected");
	      	H.charts[chartIndex].series[seriesIndex].selected = false;
	    	}

	    	H.Chart.prototype.setGraphCSSClasses = function() {
	   			$.each(H.charts, function(key, chart) {
						$.each(chart.series, function (key, series) {
							series.refseriesindex = key;
							if(series.graph) {
								series.graph.element.setAttribute("class", "series-class-" + key);
					    	series.graph.element.setAttribute("data-index", key);
							}
						});

						// set CSS classes on the area fills
						$('.chart[data-highcharts-chart="' + key + '"] .highcharts-series path:nth-child(2)').each(function(){
		          var lineIndex = $(this).attr("data-index");
		          $(this).parent('.highcharts-series').find('path:first-child').attr("class", "series-fill-" + lineIndex);
		        });
					});
	   		}

	   		H.Chart.prototype.resetLineStyling = function() {
					$.each(H.charts, function(key, chart) {
						$.each(chart.series, function (key, series) {
							if(series.graph != undefined) {
								if(series.selected) {
									series.graph.element.setAttribute("style", "opacity: 1");
		        			series.graph.parentGroup.element.children[0].setAttribute("style", "opacity: 1");
								} else {
									series.graph.element.setAttribute("style", "opacity: 0.3");
		        			series.graph.parentGroup.element.children[0].setAttribute("style", "opacity: 0");
								}						
							}							
						});  	
					});
				}

				H.Chart.prototype.setFirstVisibleSeriesToSelected = function() {
					// set first visible line of each chart to be selected
					$.each(H.charts, function(key, chart) {
						for(var s = 0; s < chart.series.length; s++) {
							if(chart.series[s].visible == true) {
								chart.series[s].graph.element.setAttribute("data-selected", "selected");
	      				chart.series[s].selected = true;
								break;
							}
						}
					});
				}

				H.Chart.prototype.setGraphFillsTransparency = function() {
					$.each(H.charts, function(key, chart) {
						$.each(chart.series, function (key, series) {
							if(series.graph != undefined) {
		        		series.graph.parentGroup.element.children[0].setAttribute("style", "opacity: 0.25");
							}
						});  	
					});
				}

				H.Chart.prototype.highlightAChartSeries = function(chartContainerId, seriesToHighlight) {
				$('#' + chartContainerId + ' .series-class-' + seriesToHighlight).each(function(){
					var $this = $(this);
					$this.css("opacity", 0.3);
          $this.animate({ "opacity": 1 }, 100);
				});
			}

			H.Chart.prototype.unhighlightAChartSeries = function(chartContainerId, seriesToUnhighlight) {
				$('#' + chartContainerId + ' .series-class-' + seriesToUnhighlight).each(function(){
					var $this = $(this);
					$this.css("opacity", "1");
          $this.animate({ "opacity": 0.3 }, 100);
				});
			}

	    }(Highcharts));

	    // generateChart is template only to speed up generating three charts in the template
	    function generateChart(containerId, dataType, seriesData, seriesColour, chartType, isMerged) {

	    	var seriesColour,
	    			seriesArray = [],
	    			yAxesSettings; // Mock only

	    	if(isMerged) { // Mock only
	    		yAxesSettings = [{
	          offset: -27,
	          showFirstLabel: false,
	          showLastLabel: true,
	          gridLineWidth: 0,
	          labels: {
	          	align: 'left',
	          	style: {
	          		color: '#81879d',
	          		fontSize: "12px"
	          	}
	          },
	          title: {
	          	text: null
	          }            
	        },
	        {
	          offset: -25,
	          showFirstLabel: false,
	          showLastLabel: true,
	          gridLineWidth: 0,
	          opposite: true,
	          labels: {
	          	align: 'right',
	          	style: {
	          		color: '#6d69c5',
	          		fontSize: "12px"
	          	}
	          },
	          title: {
	          	text: null
	          }            
	        }];

	        // TEMPLATE ONLY, structuring the data for the combined chart. Create the combined chart by adding a revenue series, followed by the download series, for each app
	        for(var a = 0; a < seriesData[0].length * 2; a++) {
	        	var isRevenue = (a % 2 == 1) ? false : true;
	        	var thisSeriesColour, seriesColourIndex;
	        	if(isRevenue) {
	        		seriesColourIndex = a/2;
	        		thisSeriesColour = seriesColour[seriesColourIndex];
	        	} else {
	        		if(a != 1) {
	        			seriesColourIndex = (a-1) / 2;
	        			thisSeriesColour = seriesColour[seriesColourIndex];
	        		} else {
	        			thisSeriesColour = "#918edf";
	        		}
	        	}

	        	// TEMPLATE ONLY: for creating the series data - get the index for the mock data array
	        	var dataIndex;
	        	if(a != 1) { // not the downloads total line
	        		dataIndex = (isRevenue) ? (a / 2) : (a-1) / 2;
	        	} else {
	        		dataIndex = 0;
	        	}

	        	var seriesName = "";
	        	if(isRevenue) {
	        		if(a == 0) {
	        			seriesName = "revenueseries-total";
	        		} else {
	        			seriesName = "revenueseries";
	        		}
	        	} else {
	        		if(a == 1) {
	        			seriesName = "downloadsseries-total";
	        		} else {
	        			seriesName = "downloadsseries";
	        		}
	        	}

	        	// TEMPLATE ONLY: Create mock series
	        	seriesArray.push({
		         	yAxis: (isRevenue) ? 0 : 1,
		          name: seriesName,
	            id : seriesName,
		          color: thisSeriesColour,
		          data: (isRevenue) ? seriesData[0][dataIndex] : seriesData[1][dataIndex],
		          borderRadiusTopLeft: 3,
        			borderRadiusTopRight: 3,
		          pointStart: Date.UTC(2016, 0, 1),
		          pointInterval: 24 * 3600 * 1000, // one day
		          lineColor: thisSeriesColour,
		          lineWidth: 3,
		          lineWidthPlus: 0,
		          fillOpacity: 0,
		          fillColor: {
	              linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
	              stops: [
	                [0, 'rgba(109,105,197,0.1)'],
	                [1, 'rgba(27,199,159,0.1)']
	              ]
	            },
	            dashStyle: (isRevenue || a == 1) ? 'line' : 'shortdash',
		          marker: {
		            enabled: false,
		            states: {
		              hover: {
		                enabled: true,
		                lineWidth: 0,
		                lineWidthPlus: 0,
		                radius: 4,
		                radiusPlus: 0,
		              }
		            }
		          }		          
		        });
	        }

	      } else { // else single chart, so one yaxis
	      	yAxesSettings = [{
	    			reversed: false,
	          offset: -27,
	          showFirstLabel: false,
	          showLastLabel: true,
	          gridLineWidth: 0,
	          labels: {
	          	align: 'left',
	          	style: {
	          		color: '#81879d',
	          		fontSize: "12px"
	          	}
	          },
	          title: {
	          	text: null
	          }         
	        }];

	        // TEMPLATE ONLY: Create mock series
	        for(var a = 0; a < seriesData.length; a++) {

	        	var seriesName = dataType;
	        	if(a == 0) {
	        		seriesName += "-total";
        		}

	        	seriesArray.push({
		         	yAxis: 0,
		          name: seriesName,
		          id : seriesName,
		          color: (dataType == "downloadsseries" && a == 0) ? "#918edf" : seriesColour[a],
		          data: seriesData[a],
		          borderRadiusTopLeft: 3,
        			borderRadiusTopRight: 3,
		          pointStart: Date.UTC(2016, 0, 1),
		          pointInterval: 24 * 3600 * 1000, // one day
		          lineColor: (dataType == "downloadsseries" && a == 0) ? "#918edf" : seriesColour[a],
		          lineWidth: 3,
		          lineWidthPlus: 0,
		          fillOpacity: 0,
		          fillColor: {
	              linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
	              stops: [
	                [0, 'rgba(109,105,197,0.1)'],
	                [1, 'rgba(27,199,159,0.1)']
	              ]
	            },
		          marker: {
		            enabled: false,
		            states: {
		              hover: {
		                enabled: true,
		                lineWidth: 0,
		                lineWidthPlus: 0,
		                radius: 4,
		                radiusPlus: 0,
		              }
		            }
		          }
		        });
	        }
	      }

	    	// Generate Demo Chart, using the properties set above
				var chart = new Highcharts.Chart({
					chart: {
	          renderTo: containerId,
						marginLeft: 0,
						marginRight: 0,
						marginBottom: 0,
						marginTop: 0,
						spacing: [0,0,0,0],
						height: 306,
						backgroundColor: '#fcfdfd',
						plotBackgroundColor: '#f2f2f5',
			   		type: chartType,
			   		animation: false,
			   		style: {
	            fontFamily: 'Source Sans Pro'
	          },
	          events: {
	            load: function() {
	                var countIndex = 0;
	                var graphPointAnimationDelay = 20;

	                // set the all series opacity on load
	                var countIndex = 0;
	                $('#' + containerId + ' .highcharts-series path:nth-child(2)').each(function() { // gets each series line
	                  if (countIndex > 0) { // first series is set to visible
	                    $(this).attr("style", "opacity: 0.3");
	                    $(this).siblings("path").attr("style", "opacity: 0");
	                  } else {
	                    $(this).attr("style", "opacity: 1");
	                  }
	                  countIndex++;
	                });
	            }
	          }
				  },
				  legend: {
				  	enabled: false
				  },
				  title: {
	            text: ''
	        },
	        yAxis: yAxesSettings,
	        xAxis: {
	        	lineColor: '#e1e5e8',
            lineWidth: 1,
	        	startOnTick: false,
	        	endOnTick: false,
	        	showFirstLabel: false,
	          maxPadding: 0,
	          minPadding: 0,
	          type: 'datetime',
	          dateTimeLabelFormats: {
	              day: '%e %b'
	          },
	          tickmarkPlacement: 'on',
	          tickPixelInterval: 30,
	          tickLength: 0,     
	          labels: {
	          	align: 'center',
	            x: 0,
	            y: 18,
	            step: 2,
	            style: {
	              color: '#81879d',
	              fontSize: "12px"
	            }
	          },
	        },
	        plotOptions: {
	        	area: {
	            trackByArea: false,
	        		tooltip: {
	        			followPointer: true
	        		},
	        		states: {
	        			hover: {
	        				halo: {
	        					size: 0
	        				},
	        				lineWidthPlus: 0
	        			}
	        		},
	        		marker: {
	        			symbol: "circle"
	        		}		
	        	},
	        	bar: {
	        		borderColor: "#f2f2f5",
	        		borderWidth: 1,
	        		groupPadding: 0.08,
	        		pointPadding: 0,
	        		states: {
	        			hover : {
	        				brightness: 0.1
	        			}
	        		}
	        	},
	          series: {
	            events: {
	              click: function() { // clicking on a series selects it and highlights it

	              	// on selecting a series, previously selected series need to be set to unselected, on all charts
	                var that = this,
	                		indexToSelect = that.refseriesindex;

	                if(!that.selected) { // if user clicked on a line that isn't currently selected

	                	// get the index of the previously selected line
	                	var previousSelectedIndex = $('#' + containerId + ' .highcharts-series path[data-selected]').attr("data-index");

	                		// set the previously selected line to unselected
	                		if(previousSelectedIndex != undefined) {
	                			that.chart.setSeriesToUnselected(that.chart.index, previousSelectedIndex);
	                		}

		                	// set the clicked line to selected
		                	that.selected = true;
		                	that.graph.element.setAttribute("data-selected", "selected");

		                	// animate the selected line change
		                	that.chart.animateSelectedLines('#' + containerId, indexToSelect, previousSelectedIndex);

			                // Update all other charts with the selection
			                if(that.chart.index < 2) { // currently viewing the twin charts
			                	
			                	// get the index of the other twin chart
			                	var mirrorChartIndex = (that.chart.index == 0) ? 1 : 0;

			                	// remove previously selected from twin chart
			                	if(previousSelectedIndex != undefined) {
			                		that.chart.setSeriesToUnselected(mirrorChartIndex, previousSelectedIndex);                	
				                }

			                	// get the previously selected line on the combined chart
			                	// and remove previously selected state from combined chart
			                	var previousSelectedIndexOnCombined = $('.chart[data-highcharts-chart="2"] .highcharts-series path[data-selected]').attr("data-index");

			                	if(previousSelectedIndexOnCombined != undefined) {
			                		that.chart.setSeriesToUnselected(2, previousSelectedIndexOnCombined);
			                	}

			                	// set the clicked line to selected on the twin chart
			                	that.chart.setSeriesToSelected(mirrorChartIndex, indexToSelect);

			                	// set the clicked line to selected on the combined chart
			                	var indexToSelectOnCombinedChart = indexToSelect * 2;

			                	that.chart.setSeriesToSelected(2, indexToSelectOnCombinedChart);

			                	// animate the selected line change on the mirrored and combined charts
			                	that.chart.animateSelectedLines('.chart[data-highcharts-chart="' + mirrorChartIndex + '"]', indexToSelect, previousSelectedIndex);
			                	that.chart.animateSelectedLines('.chart[data-highcharts-chart="2"]', indexToSelectOnCombinedChart, previousSelectedIndexOnCombined);
			                
			                } else { 
												
												// using the combined chart, so select the same for the twin charts
												if(previousSelectedIndex != undefined) {
			                		var correspondingIndexOfPreviouslySelectedOnTwinCharts = Math.floor(previousSelectedIndex / 2); // (combined has twice the series lines as a twin chart)

			                		// unselect the previously selected line on twin charts
			                		that.chart.setSeriesToUnselected(0, correspondingIndexOfPreviouslySelectedOnTwinCharts);
			                		that.chart.setSeriesToUnselected(1, correspondingIndexOfPreviouslySelectedOnTwinCharts);
				                }

				                var correspondingIndexToSelectOnTwinCharts = Math.floor(indexToSelect/2);

			                	// set the clicked line to selected on the twin charts
			                	that.chart.setSeriesToSelected(0, correspondingIndexToSelectOnTwinCharts);
			                	that.chart.setSeriesToSelected(1, correspondingIndexToSelectOnTwinCharts);

			                	// animate the selected line change on the mirrored chart
			                	that.chart.animateSelectedLines('.chart[data-highcharts-chart="0"]', correspondingIndexToSelectOnTwinCharts, correspondingIndexOfPreviouslySelectedOnTwinCharts);

			                	that.chart.animateSelectedLines('.chart[data-highcharts-chart="1"]', correspondingIndexToSelectOnTwinCharts, correspondingIndexOfPreviouslySelectedOnTwinCharts);
			                }
	                }
	              },
	            },
	            cursor: 'pointer',
	            animation: false
	          },
	      	},
	        series: seriesArray,
	        tooltip: {
	        	useHTML: true,
	        	shared: true,
	          formatter: function() {
	            var instance = this;
	            var s = "";
	            var thisPointIndex = instance.points[0].point.index;
	            // for stacked percentage
	            // TO DO - bug if first line is off
	            var thisPointTotalValue = instance.points[0].series.chart.series[0].data[thisPointIndex].y;

	            $.each(instance.points, function (index, value) {
	                var chartSeries = value.series;
	                var imgString = "",
	                		storeString = ""
	                		valueString = "",
	                		stackedString = "";

	                if(chartSeries.name == "revenueseries") {
	                	valueString = "$ ";
	                }
	                if(chartSeries.name == "revenueseries-total") {
	                	valueString = "$ ";
	                	imgString = "<img src=images/icon-chart-tt-revenue@2x.png alt='Rank icon' class=icon-revenue />";
	                } else if(chartSeries.name == "downloadsseries-total") {
	                	imgString = "<img src=images/icon-chart-tt-downloads@2x.png alt='Rank icon' class=icon-downloads />";	
	                }
	                
	                var seriesClassName = chartSeries.name;
	                if(seriesClassName == "revenueseries-total") {
	                	seriesClassName = "revenueseries";
	                } else if(seriesClassName == "downloadsseries-total") {
	                	seriesClassName = "downloadsseries";
	                }

	                if($('#toggle--show-stacked').is(":checked") && thisPointTotalValue != undefined) {
	                	var percentageOfTotal = parseInt(value.y / thisPointTotalValue * 100);
	                	stackedString = "<span class='chart-tooltip-percentage' style='background-color: " + chartSeries.color + "'>" + percentageOfTotal + "%</span>";
	                }

	                s += '<div class="custom-tooltip ' + seriesClassName + '" style="background-color: ' + chartSeries.color + '">' + imgString + storeString + '<span class="chart-tooltip-value">' + valueString + value.y + '</span>' + stackedString + '</div>';
	            });
	            return s;
	          },
	        	backgroundColor: 'transparent',
	          borderWidth: 0,
	          borderColor: '#dae3ed',
				    crosshairs: [{
	            width: 1,
	            color: '#9ea7c4'
	          }],
	          shadow: {
	            color: 'rgba(0,0,0,0.24)',
	            width: 0,
	            offsetX: 1,
	            offsetY: 1
	        	},
	        	snap: 25,
	        	// the positioner callback could be used in future for the combined chart where it goes off the left of the graph
	        	// positioner: function (labelWidth, labelHeight, point) {
          //     console.log("labelWidth = " + labelWidth);
          //     console.log("labelHeight = " + labelHeight);
          //     console.log(point);
          //     return { x: point.plotX, y: 0 };
          //   },
	        }
		    });

			} // end generateChart()

			function addAppDataToSeries() {
				// add the app icon and store to the Highcharts series objects for the tooltip

				// template only, mock data
				for(var k = 0; k < 2; k++) {
					$.each(Highcharts.charts[k].series, function (key, series) { // twin chart
				    series.appIcon = seriesAppIcons[key].icon;
				    series.appStore = seriesAppIcons[key].store;
					});
				}

				$.each(Highcharts.charts[2].series, function (key, series) { // combined chart
			    // combined chart, use the same icon for rev and downloads
			    var combinedSeriesIndex = Math.floor(key / 2);
			    series.appIcon = seriesAppIcons[combinedSeriesIndex].icon;
			    series.appStore = seriesAppIcons[combinedSeriesIndex].store;
				});
			}

			function handleCustomLegendInteraction() {

				// Hide/show series from custom legend
				$('.js-custom-chart-key').on("click", '.js-toggle-series', function(){ // for each current or new '.js-toggle-series' (checkbox in the legend)

					var $this = $(this);
					var chartIndex = $this.attr("data-chart-index");
					var seriesIndex = $this.attr("data-series-index");					

					var currentChartType = "area";
					$('.toggle input[type=radio][name=charttype]').each(function(){
						if($(this).is(":checked")) {
							currentChartType = $(this).attr("data-chart-type");
						}
					});

					if(chartIndex < 2) { // user is using the twin chart

						if($(this).is(":checked")) {
							// turn on same series on both twin charts
							Highcharts.charts[0].series[seriesIndex].show();
							Highcharts.charts[1].series[seriesIndex].show();

							// turn on the combined chart corresponding series
							Highcharts.charts[2].series[seriesIndex * 2].show();
							Highcharts.charts[2].series[(seriesIndex * 2) + 1].show();

							// only reset styles for non-stacked area chart
							setTimeout(function(){
								if(!$('#toggle--show-stacked').is(":checked") && currentChartType == "area") {
									Highcharts.Chart.prototype.setGraphCSSClasses();
									Highcharts.Chart.prototype.resetLineStyling();
								} else {
									Highcharts.Chart.prototype.setGraphCSSClasses();
									Highcharts.Chart.prototype.setGraphFillsTransparency();
								}
							}, 200);

							// turn off other checkboxes in mirror chart key
							$('.js-twin-chart-container .js-toggle-series').each(function(){
								var $thisToggle = $(this);
								if(!$thisToggle.is($this)) {
									if($thisToggle.attr("data-series-index") == seriesIndex) {
										$thisToggle[0].checked = true;
									}
								}
							});

							// combined chart turn on/off corresponding series
							$('.js-combined-chart-container .js-toggle-series').each(function(){
								var $thisToggle = $(this);
								if(!$thisToggle.is($this)) {
									if($thisToggle.attr("data-series-index") == seriesIndex * 2 || $thisToggle.attr("data-series-index") == (seriesIndex * 2) + 1) {
										$thisToggle[0].checked = true;
									}
								}
							});

						} else { // turn off the series on all charts
							setTimeout(function(){
								
								var isStackedChart = true;
								if(currentChartType == "area") {

									// If the line being turned off is selected then unselect, and select first visible line
									if(Highcharts.charts[0].series[seriesIndex].selected == true) {
										
										isStackedChart = false;

										// unselect for twin charts
										Highcharts.Chart.prototype.setSeriesToUnselected(0, seriesIndex);
										Highcharts.Chart.prototype.setSeriesToUnselected(1, seriesIndex);

										// unselect for combined chart
										var previousSelectedIndexOnCombined = $('.chart[data-highcharts-chart="2"] .highcharts-series path[data-selected]').attr("data-index");

										Highcharts.Chart.prototype.setSeriesToUnselected(2, previousSelectedIndexOnCombined);
									}
								}

								// Hide the series
								Highcharts.charts[0].series[seriesIndex].hide();
								Highcharts.charts[1].series[seriesIndex].hide();

								// hide on the combined chart
								Highcharts.charts[2].series[seriesIndex * 2].hide();
								Highcharts.charts[2].series[(seriesIndex * 2) + 1].hide();

								setTimeout(function(){
									if(!isStackedChart) {
										Highcharts.Chart.prototype.setFirstVisibleSeriesToSelected();
										Highcharts.Chart.prototype.setGraphCSSClasses();
						        Highcharts.Chart.prototype.resetLineStyling();
									}
								}, 200);
							}, 200);

							// turn off other checkboxes in mirror chart key
							$('.js-twin-chart-container .js-toggle-series').each(function(){
								var $thisToggle = $(this);
								if(!$thisToggle.is($this)) {
									if($thisToggle.attr("data-series-index") == seriesIndex) {
										$thisToggle[0].checked = false;
									}
								}
							});

							// combined chart turn on/off corresponding series
							$('.js-combined-chart-container .js-toggle-series').each(function(){
								var $thisToggle = $(this);
								if(!$thisToggle.is($this)) {
									if($thisToggle.attr("data-series-index") == seriesIndex * 2 || $thisToggle.attr("data-series-index") == (seriesIndex * 2) + 1) {
										$thisToggle[0].checked = false;
									}
								}
							});

						}

					} else { // user is using combined chart

						if($(this).is(":checked")) {
							Highcharts.charts[2].series[seriesIndex].show();

							// if both rev and dloads are selected on combined, turn that series on on the twin charts
								
							// get the corresponding series to see if it's visible
							var correspondingSeriesIndex,
									isDownloadsSeriesBeingTurnedOn = seriesIndex % 2 == 1;

							if(isDownloadsSeriesBeingTurnedOn) {
								correspondingSeriesIndex = seriesIndex - 1;
							} else {
								correspondingSeriesIndex = parseInt(seriesIndex) + 1;
							}

							var isCorrespondingSeriesVisible = Highcharts.charts[2].series[correspondingSeriesIndex].visible;

							if(isCorrespondingSeriesVisible) {

								// make sure correspondingTwinIndex is set to corresponding twin chart index
								var correspondingTwinIndex;
								if(isDownloadsSeriesBeingTurnedOn) {
									correspondingTwinIndex = (seriesIndex - 1) / 2;
								} else {
									correspondingTwinIndex = seriesIndex / 2
								}

								// turn it on on the twin chart
								Highcharts.charts[0].series[correspondingTwinIndex].show();
								Highcharts.charts[1].series[correspondingTwinIndex].show();

								// set the key toggle
								$('.js-twin-chart-container .js-toggle-series').each(function(){
									var $thisToggle = $(this);
									if(!$thisToggle.is($this)) {
										if($thisToggle.attr("data-series-index") == correspondingTwinIndex) {
											$thisToggle[0].checked = true;
										}
									}
								});
							}

							// if non-stacked area chart, reset CSS styles/classes
							if(!$('#toggle--show-stacked').is(":checked") && currentChartType == "area") {
								Highcharts.Chart.prototype.setGraphCSSClasses();
								Highcharts.Chart.prototype.resetLineStyling();
							} else {
								Highcharts.Chart.prototype.setGraphCSSClasses();
								Highcharts.Chart.prototype.setGraphFillsTransparency();
							}

						} else {
							setTimeout(function(){

								// If series is selected, select next visible series
								var isStackedChart = true;

								var correspondingTwinIndex;
								if(seriesIndex % 2 == 1) {
									correspondingTwinIndex = (seriesIndex - 1) / 2;
								} else {
									correspondingTwinIndex = seriesIndex / 2
								}

								if(currentChartType == "area") {

									if(Highcharts.charts[2].series[seriesIndex].selected == true) {
										
										isStackedChart = false;

										Highcharts.Chart.prototype.setSeriesToUnselected(2, seriesIndex);

										// Deselect the equivalent line on the twin charts
										Highcharts.Chart.prototype.setSeriesToUnselected(0, correspondingTwinIndex);
										Highcharts.Chart.prototype.setSeriesToUnselected(1, correspondingTwinIndex);
									}
								}

								// Hide the series
								Highcharts.charts[2].series[seriesIndex].hide();
								Highcharts.charts[0].series[correspondingTwinIndex].hide();
								Highcharts.charts[1].series[correspondingTwinIndex].hide();

								// set the key toggle
								$('.js-twin-chart-container .js-toggle-series').each(function(){
									var $thisToggle = $(this);
									if(!$thisToggle.is($this)) {
										if($thisToggle.attr("data-series-index") == correspondingTwinIndex) {
											$thisToggle[0].checked = false;
										}
									}
								});

								setTimeout(function(){
									if(!isStackedChart) {
										Highcharts.Chart.prototype.setFirstVisibleSeriesToSelected();
										Highcharts.Chart.prototype.setGraphCSSClasses();
						        Highcharts.Chart.prototype.resetLineStyling();					
									}
								}, 200);
							}, 200);
						}
					}		
				});

				// hover on/off key to highlight lines
				$('.js-hover-series').on("mouseenter", function(){					
					handleMouseEnterChartKeyLabel($(this));
				}).on("mouseleave", function(){
					handleMouseLeaveChartKeyLabel($(this));
				});
			}

			function handleShowBarChart() {

				// change chart type
				$('.js-toggle--show-bar').on("click", function(){

					if(!$(this).hasClass("is-disabled")) {

						$('.js-mock-show-single-chart.is-disabled').removeClass("is-disabled")
																					.siblings("input").removeAttr("disabled", "disabled");

						$.each(Highcharts.charts, function(key, chart) {
							$.each(chart.series, function (key, series) {
						    series.update({
						    	type: 'bar',
						    	stacking: null
						    });
							});
						});
					}

					addAppDataToSeries();
					redrawChartEvents();
				});
			}

			function handleShowAreaChart() {
				// change chart type
				$('.js-toggle--show-area').on("click", function(){

					// disabled the toggle for combined chart
					$('.js-mock-show-single-chart.is-disabled').removeClass("is-disabled")
																					.siblings("input").removeAttr("disabled", "disabled");

					$.each(Highcharts.charts, function(key, chart) {
						$.each(chart.series, function (key, series) {
					    series.update({
					    	type: 'area',
					    	stacking: null,
					    	fillColor: {
		              linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
		              stops: [
		                [0, 'rgba(109,105,197,0.1)'],
		                [1, 'rgba(27,199,159,0.1)']
		              ]
		            },
		            lineWidth: 3
					    });
						});
					});

					Highcharts.Chart.prototype.setFirstVisibleSeriesToSelected();
					Highcharts.Chart.prototype.setGraphCSSClasses();
	        Highcharts.Chart.prototype.resetLineStyling();

	        addAppDataToSeries();
	        redrawChartEvents();
				});
			}

			function handleShowStackedAreaChart() {

				// change chart type
				$('.js-toggle--show-stacked').on("click", function(){

					if(!$(this).hasClass("is-disabled")) {
						// disabled the toggle for combined chart
						$('.js-mock-show-single-chart').addClass("is-disabled")
																						.siblings("input").attr("disabled", "disabled");

						$.each(Highcharts.charts, function(key, chart) {
							$.each(chart.series, function (key, series) {
								if(key > 0) { // all lines other than the first line (the total line) are stacked - the total does not make up the stacked chart and stays with stacking: null
									series.update({
										type: 'area',
							    	stacking: 'normal',
							    	fillColor: seriesFills[key],
							    	lineWidth: 2
							    });
								} else { // the first line is the total line for the stacked chart and should not be part of the stacked area
									series.update({
										type: 'area',
										stacking: null,
										fillColor: seriesFills[key],
										lineWidth: 2
									});
								}				    
							});
						});

						Highcharts.Chart.prototype.setGraphCSSClasses();
						Highcharts.Chart.prototype.setGraphFillsTransparency();

						addAppDataToSeries();
						redrawChartEvents()
					}
				});
			}

			function handleAddSeriesTest() {

				// mock, just for index when you add a series
				// not needed in app
				Highcharts.charts[0].numberofSeriesAdded = Highcharts.charts[0].series.length - 1; 

				$('.js-add-series').on("click", function(e){

					e.preventDefault();

					// set stacking to normal if currently viewing stacked chart
					var stackingValue = null;
					if($('#toggle--show-stacked').is(":checked")) {
						stackingValue = 'normal';
					}

					var chartType = "area";
					if($('#toggle--show-bar').is(":checked")) {
						chartType = "bar";
					}

					var mockSeries = [];
					for(var d = 0; d < 12; d++) {
						var randomNumber = Math.floor((Math.random() * 50000) + 30000);				
						mockSeries.push(randomNumber);
					}
					var mockSeriesDownloads = [];
					for(var d = 0; d < 12; d++) {
						var randomNumber = Math.floor((Math.random() * 50000) + 30000);		
						mockSeriesDownloads.push(randomNumber);
					}

					// get a series colour that's not in use
					var availableColour = "#1bc79f";
					for(var c = 1; c < seriesColours.length; c++) { // (0 is used by revenue total)
						colourInUse = (usedSeriesColours.indexOf(seriesColours[c]) > -1) ? true : false;
						if(!colourInUse) {
							availableColour = seriesColours[c];
							availableColourIndex = c;
							break;
						}
					}

					usedSeriesColours.push(availableColour);

					var fillColourForNewSeries = {
							linearGradient: { x1: 0, x2: 0, y1: 0, y2: 1 },
              stops: [
                [0, 'rgba(109,105,197,0.1)'],
                [1, 'rgba(27,199,159,0.1)']
              ]
          };

					if(stackingValue == 'normal') {
						fillColourForNewSeries = seriesFills[availableColourIndex];
					}

					Highcharts.charts[0].addSeries({
          	yAxis: 0,
	          name: "revenueseries",
            id : "revenueseries",
            type: chartType,
	          color: availableColour,
	          data: mockSeries,
	          pointStart: Date.UTC(2016, 0, 1),
	          pointInterval: 24 * 3600 * 1000, // one day
	          lineColor: availableColour,
	          lineWidth: (stackingValue == null) ? 3 : 2,
	          lineWidthPlus: 0,
	          fillOpacity: 0,
	          fillColor: fillColourForNewSeries,
            stacking: stackingValue,
	          marker: {
	            enabled: false,
	            states: {
	              hover: {
	                enabled: true,
	                lineWidth: 0,
	                lineWidthPlus: 0,
	                radius: 4,
	                radiusPlus: 0,
	              }
	            }
	          }
         	});

         	Highcharts.charts[1].addSeries({
          	yAxis: 0,
	          name: "downloadsseries",
            id : "downloads",
            type: chartType,
	          color: availableColour,
	          data: mockSeriesDownloads,
	          pointStart: Date.UTC(2016, 0, 1),
	          pointInterval: 24 * 3600 * 1000, // one day
	          lineColor: availableColour,
	          lineWidth: (stackingValue == null) ? 3 : 2,
	          lineWidthPlus: 0,
	          fillOpacity: 0,
	          fillColor: fillColourForNewSeries,
            stacking: stackingValue,
	          marker: {
	            enabled: false,
	            states: {
	              hover: {
	                enabled: true,
	                lineWidth: 0,
	                lineWidthPlus: 0,
	                radius: 4,
	                radiusPlus: 0,
	              }
	            }
	          }
         	});

         	Highcharts.charts[2].addSeries({
          	yAxis: 0,
	          name: "revenueseries",
            id : "revenueseries",
            type: chartType,
	          color: availableColour,
	          data: mockSeries,
	          pointStart: Date.UTC(2016, 0, 1),
	          pointInterval: 24 * 3600 * 1000, // one day
	          lineColor: availableColour,
	          lineWidth: 3,
	          lineWidthPlus: 0,
	          fillOpacity: 0,
	          fillColor: fillColourForNewSeries,
	          marker: {
	            enabled: false,
	            states: {
	              hover: {
	                enabled: true,
	                lineWidth: 0,
	                lineWidthPlus: 0,
	                radius: 4,
	                radiusPlus: 0,
	              }
	            }
	          }
         	});

         	Highcharts.charts[2].addSeries({
          	yAxis: 1,
	          name: "downloadsseries",
            id : "downloads",
            type: chartType,
	          color: availableColour,
	          data: mockSeriesDownloads,
	          pointStart: Date.UTC(2016, 0, 1),
	          pointInterval: 24 * 3600 * 1000, // one day
	          lineColor: availableColour,
	          lineWidth: 3,
	          lineWidthPlus: 0,
	          fillOpacity: 0,
	          fillColor: fillColourForNewSeries,
            dashStyle: 'shortdash',
	          marker: {
	            enabled: false,
	            states: {
	              hover: {
	                enabled: true,
	                lineWidth: 0,
	                lineWidthPlus: 0,
	                radius: 4,
	                radiusPlus: 0,
	              }
	            }
	          }
         	});

         	// reset lines CSS and styling if not viewing stacked chart
					if(stackingValue == null) {
						setTimeout(function(){
							Highcharts.Chart.prototype.setGraphCSSClasses();
		      		Highcharts.Chart.prototype.resetLineStyling();
		      	}, 200);
					} else {
						Highcharts.Chart.prototype.setGraphCSSClasses();
						Highcharts.Chart.prototype.setGraphFillsTransparency();
					}

					Highcharts.charts[0].numberofSeriesAdded++; // MOCK, just to generate index

					// in the app, ("showhiderevenue-" + Highcharts.charts[0].numberofSeriesAdded) should be replaced with an id for that series
					// the (Highcharts.charts[0].numberofSeriesAdded) index should be the same as the series index
					addASeriesToggle(Highcharts.charts[0].series.length - 1, "showhiderevenue-" + Highcharts.charts[0].numberofSeriesAdded, availableColourIndex);

					addAppDataToSeries();

				});

			}

			function handleRemoveSeriesTest() {
				$('.js-remove-series').on("click", function(e){

					e.preventDefault();

					var isStackedChart = true;
					if($('.chart[data-highcharts-chart="0"] .highcharts-series path[data-selected]').length) {
						isStackedChart = false;
					}

					var removedLineWasSelected = false;
					if(Highcharts.charts[0].series[2].selected == true) {
						removedLineWasSelected = true;
					}

					// mock removal of series 2
					Highcharts.charts[0].series[2].remove(true);
					Highcharts.charts[1].series[2].remove(true);

					// remove from combined chart - the indexes are the same, because after the first [4] has been removed, the next line becomes [4], which is also removed (the download line for [4], was [5])
					Highcharts.charts[2].series[4].remove(true);
					Highcharts.charts[2].series[4].remove(true);

					if(!isStackedChart) {
						setTimeout(function(){
							if(removedLineWasSelected) {
								Highcharts.Chart.prototype.setFirstVisibleSeriesToSelected();
							}							
							Highcharts.Chart.prototype.setGraphCSSClasses();
		      		Highcharts.Chart.prototype.resetLineStyling();
		      	}, 200);
					}					

					removeASeriesToggle(2);
				});
			}
			
			function handleChartEvents() {

				// Use Highcharts.charts[0].refEvents[] to hold the event objects, which consist of an icon, line and tooltip content and tooltip colour
				Highcharts.charts[0].refEvents = [];

				if($('.js-toggle-events:checked').length > 0) {
					addEventsToGraph();
				}

				$('.js-toggle-events').change(function(){
					if($(this).is(":checked")) {
						if(Highcharts.charts[0].refEvents.length == 0) {
							addEventsToGraph();
						} else { // otherwise show existing events
							for (var e = 0; e < Highcharts.charts[0].refEvents.length; e++) {
								if(Highcharts.charts[0].refEvents[e].icon) {
									$(Highcharts.charts[0].refEvents[e].icon.element).fadeIn(200);
								}
								if(Highcharts.charts[0].refEvents[e].line) {
									$(Highcharts.charts[0].refEvents[e].line.element).fadeIn(200);
								}
								if(Highcharts.charts[0].refEvents[e].area) {
									$(Highcharts.charts[0].refEvents[e].area.element).fadeIn(200);
								}
								if(Highcharts.charts[0].refEvents[e].label) {
									$(Highcharts.charts[0].refEvents[e].label.element).fadeIn(200);
								}
							}
						}
					} else {
						if(Highcharts.charts[0].refEvents.length > 0) {
							// hide existing events
							for (var e = 0; e < Highcharts.charts[0].refEvents.length; e++) {
								if(Highcharts.charts[0].refEvents[e].icon) {
									$(Highcharts.charts[0].refEvents[e].icon.element).fadeOut(200);
								}
								if(Highcharts.charts[0].refEvents[e].line) {
									$(Highcharts.charts[0].refEvents[e].line.element).fadeOut(200);
								}
								if(Highcharts.charts[0].refEvents[e].area) {
									$(Highcharts.charts[0].refEvents[e].area.element).fadeOut(200);
								}
								if(Highcharts.charts[0].refEvents[e].label) {
									$(Highcharts.charts[0].refEvents[e].label.element).fadeOut(200);
								}
							}
						}
					}
				});

				// Events - Redraw events for window width change
				$(window).on("resize", function(){
					setTimeout(function(){
						redrawChartEvents();
					}, 1500);
				});
			}

			function redrawChartEvents() {
				if(Highcharts.charts[0].refEvents.length > 0) {
						// redraw events
						for (var e = 0; e < Highcharts.charts[0].refEvents.length; e++) {
							if(Highcharts.charts[0].refEvents[e].icon) {
								Highcharts.charts[0].refEvents[e].icon.destroy();
							}
							if(Highcharts.charts[0].refEvents[e].line) {
								Highcharts.charts[0].refEvents[e].line.destroy();
							}
							if(Highcharts.charts[0].refEvents[e].area) {
								Highcharts.charts[0].refEvents[e].area.destroy();
							}
							if(Highcharts.charts[0].refEvents[e].label) {
								Highcharts.charts[0].refEvents[e].label.destroy();
							}
						}
						Highcharts.charts[0].refEvents = [];						
						if(Highcharts.charts[0].refEvents.length == 0) {
							if($('.js-toggle-events:checked').length > 0) {
								addEventsToGraph();
							}
						}
					}
			}

			// Add events to the graph function
			function addEventsToGraph() {

				var chart = Highcharts.charts[0];
				var numberOfChartItems = chart.series[0].data.length - 1;
			  var chartWidth = $(chart.container).width();

			  Highcharts.charts[0].refEvents = [];

	      Highcharts.charts[0].refEvents.push({
	      	icon: chart.renderer.image('images/icon-chart-event-launch@2x.png', chart.series[0].data[2].plotX - 11, chart.chartHeight - 36, 22, 36)
		            .attr({		            	
		              zIndex: 15
		            })
		            .addClass("event-icon--launch")
		            .add(),
		    	plotX: chart.series[0].data[2].plotX,
	      },{
	      	icon: chart.renderer.image('images/icon-chart-event-flag@2x.png', chart.series[0].data[6].plotX - 1, chart.chartHeight - 38, 18, 12)
		            .attr({
		              zIndex: 9		              
		            })
		            .addClass("event-icon--flag")
		            .add(),
		      line: chart.renderer.path(['M', chart.series[0].data[6].plotX, chart.chartHeight, 'L', chart.series[0].data[6].plotX, chart.chartHeight - 38])
		            .attr({
	                'stroke-width': 1,
	                stroke: '#81879d',
	                zIndex: 8
		            })
		            .add(),
					plotX: chart.series[0].data[6].plotX,
	      },{
	      	icon: chart.renderer.image('images/icon-chart-event-flag@2x.png', chart.series[0].data[8].plotX - 1, chart.chartHeight - 38, 18, 12)
		            .attr({
		              zIndex: 9
		            })
		            .addClass("event-icon--flag")
		            .add(),
		      line: chart.renderer.path(['M', chart.series[0].data[8].plotX, chart.chartHeight, 'L', chart.series[0].data[8].plotX, chart.chartHeight - 38])
		            .attr({
	                'stroke-width': 1,
	                stroke: '#81879d',
	                zIndex: 8
		            })
		            .add(),
					plotX: chart.series[0].data[8].plotX,
		      },{
		      	icon: chart.renderer.image('images/icon-chart-event-flag@2x.png', chart.series[0].data[8].plotX - 1, chart.chartHeight - 38, 18, 12)
			            .attr({
			            	visibility: "hidden", // duplicate event flags are hidden but are needed to caluclate no of events for a given date
			              zIndex: 9
			            })
			            .addClass("event-icon--flag")
			            .add(),
			      line: chart.renderer.path(['M', chart.series[0].data[8].plotX, chart.chartHeight, 'L', chart.series[0].data[8].plotX, chart.chartHeight - 38])
			            .attr({
			            	visibility: "hidden",
		                'stroke-width': 1,
		                stroke: '#81879d',
		                zIndex: 8
			            })
			            .add(),
						plotX: chart.series[0].data[8].plotX,
				});

				// Events - Add tooltip data
				$(Highcharts.charts[0].refEvents[0].icon.element).data("tooltip", "<span>App Launch</span><br /><span>02/01/2016</span>");				
				$(Highcharts.charts[0].refEvents[0].icon.element).data("datapoint", 2);
				$(Highcharts.charts[0].refEvents[0].icon.element).data("tooltipcolour", "#FFFFFF");
				$(Highcharts.charts[0].refEvents[0].icon.element).data("tooltipfill", "rgba(145,142,223, 0.95)");

				$(Highcharts.charts[0].refEvents[1].icon.element).data("tooltip", "<span>App Name Change</span><br /><span>'Splashy Crossy Copy...'</span>");
				$(Highcharts.charts[0].refEvents[1].icon.element).data("datapoint", 6);
				$(Highcharts.charts[0].refEvents[1].icon.element).data("tooltipcolour", "#FFFFFF");
				$(Highcharts.charts[0].refEvents[1].icon.element).data("tooltipfill", "rgba(145,142,223, 0.95)");

				$(Highcharts.charts[0].refEvents[2].icon.element).data("tooltip", "<span>Price Change</span><br /><span>$0.99 - Free</span>");
				$(Highcharts.charts[0].refEvents[2].icon.element).data("datapoint", 8);
				$(Highcharts.charts[0].refEvents[2].icon.element).data("tooltipcolour", "#FFFFFF");
				$(Highcharts.charts[0].refEvents[2].icon.element).data("tooltipfill", "rgba(145,142,223, 0.95)");

				$(Highcharts.charts[0].refEvents[3].icon.element).data("tooltip", "<span>App Update</span><br /><span>Version 1.1.3.1</span>");
				$(Highcharts.charts[0].refEvents[3].icon.element).data("datapoint", 8);
				$(Highcharts.charts[0].refEvents[3].icon.element).data("tooltipcolour", "#FFFFFF");
				$(Highcharts.charts[0].refEvents[3].icon.element).data("tooltipfill", "rgba(145,142,223, 0.95)");

	      // if there are more than one events on one date, calculate and add number of events label
		      // find which plotX has more than one event and add to plotXDuplicates[]
		      var plotXDuplicates = [];
		      for (var e = 0; e < Highcharts.charts[0].refEvents.length; e++) {
		      	var thisPlotX = Highcharts.charts[0].refEvents[e].plotX;
		      	for (var a = e+1; a < Highcharts.charts[0].refEvents.length; a++) {
		      		if(Highcharts.charts[0].refEvents[a].plotX == thisPlotX) {
		      			var alreadyExists = false;
		      			if(plotXDuplicates.length > 0) {	      				
			      			for (var x = 0; x < plotXDuplicates.length; x++) {
			      				if(plotXDuplicates[x] == thisPlotX) {
			      					alreadyExists = true;
			      				}
			      			}
		      			}
		      			if(!alreadyExists) {
		      				plotXDuplicates.push(Highcharts.charts[0].refEvents[a].plotX);
		      			}	      			
		      		}
		      	}
		      }

	      	// iterate plotXDuplicates and find number of events on the same date
		      var eventIndexesForDuplicateEventDate = [],
		      		counterOfDuplicates = [];
		      for(var p = 0; p < plotXDuplicates.length; p++) {
		      	var counter = 0;
		      	for (var e = 0; e < Highcharts.charts[0].refEvents.length; e++) {
			      	if(plotXDuplicates[p] == Highcharts.charts[0].refEvents[e].plotX) {
			      		eventIndexesForDuplicateEventDate.push(e);
			      		counter++;
			      	}
			      }
			      counterOfDuplicates.push(counter);
		      }
		      
	      	// add label to chart for number of events on the same data
		      for(var p = 0; p < plotXDuplicates.length; p++) {
		      	if(Highcharts.charts[0].refEvents[eventIndexesForDuplicateEventDate[p]]) {
		      		Highcharts.charts[0].refEvents[eventIndexesForDuplicateEventDate[p]].label = chart.renderer.text('<span>' + counterOfDuplicates[p] + '</span>', plotXDuplicates[p] + 4, 265)
		          .attr({
		          	zIndex: 10
		          })
		          .css({
		            color: '#ff496a',
		            fontSize: '13px',
		            fontFamily: 'Source Sans Pro',
		            fontWeight: 'bold',
		            pointerEvents: 'none'
		          })
		          .add();
		      	}
		      }
			}

			function handleChartInteraction() {
				
				handleCustomLegendInteraction();
				handleShowBarChart();
				handleShowAreaChart();
				handleShowStackedAreaChart();

				handleAddSeriesTest();
				handleRemoveSeriesTest();

				handleChartEvents();
			}

			function handleMouseEnterChartKeyLabel($label) {
				if($('html.no-touch').length) {
					var $this = $label.siblings("input");
					var chartToHoverIndex = $this.attr("data-chart-index");
					var seriesToHover = $this.attr("data-series-index");

					var seriesToHoverArray = [seriesToHover];

					if(chartToHoverIndex < 2) { // if it's the twin chart

						for (var ch = 0; ch < 2; ch++) { // for each of the twin charts

							var chartContainerId = Highcharts.charts[ch].container.id;

							var selectedLine = $('#' + chartContainerId + ' .highcharts-series path[data-selected]').attr("data-index");

							for(var i = 0; i < seriesToHoverArray.length; i++) { // highlight one or more lines on same chart

								if(selectedLine != undefined) { // if there is a selected line, it's the area chart, just highlight the line
									if(!Highcharts.charts[ch].series[seriesToHoverArray[i]].selected) {
										Highcharts.Chart.prototype.highlightAChartSeries(chartContainerId, seriesToHoverArray[i]);
									}

								} else { // otherwise it's the stacked chart, just highlight the fill

									$('#' + chartContainerId + ' .series-fill-' + seriesToHoverArray[i]).each(function(){
										var $this = $(this);
										$this.css("opacity", 0.25);
				            $this.animate({ "opacity": 0.6 }, 100);
									});
								}
							}
						}
					} else { // user is hovering over combined chart key label
						// get the corresponding line to hover
						if(seriesToHover != 0 && seriesToHover != 1) {
							seriesToHoverArray.push(seriesToHover - 1);
						}
						var chartContainerId = Highcharts.charts[chartToHoverIndex].container.id;

						for(var i = 0; i < seriesToHoverArray.length; i++) {
							if(!Highcharts.charts[2].series[seriesToHoverArray[i]].selected) {
								Highcharts.Chart.prototype.highlightAChartSeries(chartContainerId, seriesToHoverArray[i]);
							}
						}
					}
				}
			}

			function handleMouseLeaveChartKeyLabel($label) {
				if($('html.no-touch').length) {
					var $this = $label.siblings("input");
					var chartToHoverIndex = $this.attr("data-chart-index");
					var seriesToHover = $this.attr("data-series-index");
					var seriesToHoverArray = [seriesToHover];

					if(chartToHoverIndex < 2) { // if it's the twin chart
						for (var ch = 0; ch < 2; ch++) { // for each of the twin charts

							var chartContainerId = Highcharts.charts[ch].container.id;
							var selectedLine = $('#' + chartContainerId + ' .highcharts-series path[data-selected]').attr("data-index");

							for(var i = 0; i < seriesToHoverArray.length; i++) { // highlight one or more lines on same chart
								if(selectedLine != undefined) { // if there is a selected line, it's the area chart, just highlight the line
									if(!Highcharts.charts[ch].series[seriesToHoverArray[i]].selected) {
										Highcharts.Chart.prototype.unhighlightAChartSeries(chartContainerId, seriesToHoverArray[i]);
									}
								} else { // otherwise it's the stacked chart, just highlight the fill

									$('#' + chartContainerId + ' .series-fill-' + seriesToHoverArray[i]).each(function(){
										var $this = $(this);
										$this.css("opacity", 0.6);
				            $this.animate({ "opacity": 0.25 }, 100);
									});
								}
							}
						}
					} else { // it's the combined chart
						
						// get the corresponding line to hover
						if(seriesToHover != 0 && seriesToHover != 1) {
							seriesToHoverArray.push(seriesToHover - 1);
						}
						var chartContainerId = Highcharts.charts[chartToHoverIndex].container.id;

							for(var i = 0; i < seriesToHoverArray.length; i++) {
								if(!Highcharts.charts[2].series[seriesToHoverArray[i]].selected) {
									Highcharts.Chart.prototype.unhighlightAChartSeries(chartContainerId, seriesToHoverArray[i]);
								}
							}
					}
				}
			}

			function addASeriesToggle(seriesIndex, seriesName, availableColourIndex) {

				// Add a new toggle to the chart key
				var newToggle = $('<li>').addClass("series-" + availableColourIndex);
				var newCheckbox = $('<input>').attr("type", "checkbox")
																			.attr("name", seriesName)
																			.attr("id", seriesName)
																			.addClass("js-toggle-series")
																			.attr("data-chart-index", "0")
																			.attr("data-series-index", seriesIndex)
																			.attr("checked", "checked");
				
				var newCheckboxLabel = $('<label>').attr("for", seriesName)
																						.addClass("checkboxLabel")
																						.text("Another App");

				var newCheckboxLabelVisible = $('<label>').attr("for", seriesName)
																						.addClass("checkboxLabelVisible")
																						.attr("data-chart-index", "0")
																						.text("Another App")
																						.on("mouseenter", function(){
																							handleMouseEnterChartKeyLabel($(this));
																						})
																						.on("mouseleave", function(){
																							handleMouseLeaveChartKeyLabel($(this));
																						});

				newToggle.append(newCheckbox)
									.append(newCheckboxLabel)
									.append(newCheckboxLabelVisible);

				$('.js-twin-chart-container .js-custom-chart-key ul').append(newToggle);


				// Add a new toggle to the chart key on the combined chart
				// combined revenue checkbox
				seriesName += "-combined";
				var newToggle = $('<li>').addClass("revenue-key-combined-chart series-" + availableColourIndex);
				var newCheckbox = $('<input>').attr("type", "checkbox")
																			.attr("name", seriesName)
																			.attr("id", seriesName)
																			.addClass("js-toggle-series")
																			.attr("data-chart-index", "2")
																			.attr("data-series-index", seriesIndex * 2)
																			.attr("checked", "checked");
				
				var newCheckboxLabel = $('<label>').attr("for", seriesName)
																						.addClass("checkboxLabel")
																						.text("Another App");

				var newCheckboxLabelVisible = $('<label>').attr("for", seriesName)
																						.addClass("checkboxLabelVisible js-hover-series");

				newToggle.append(newCheckbox)
									.append(newCheckboxLabel)
									.append(newCheckboxLabelVisible);

				// combined downloads checkbox
				seriesName += "--downloads";
				var newToggleDownloads = $('<li>').addClass("downloads-key-combined-chart series-" + availableColourIndex);
				var newCheckbox = $('<input>').attr("type", "checkbox")
																			.attr("name", seriesName)
																			.attr("id", seriesName)
																			.addClass("js-toggle-series")
																			.attr("data-chart-index", "2")
																			.attr("data-series-index", (seriesIndex * 2) + 1)
																			.attr("checked", "checked");
				
				var newCheckboxLabel = $('<label>').attr("for", seriesName)
																						.addClass("checkboxLabel")
																						.text("Another App");

				var seriesIndexPlusOne = (seriesIndex * 2) + 1;
				var newCheckboxLabelVisible = $('<label>').attr("for", seriesName)
																						.addClass("checkboxLabelVisible js-hover-series")
																						.text("Another App")
																						.on("mouseenter", function(){
																							handleMouseEnterChartKeyLabel($(this));
																						})
																						.on("mouseleave", function(){
																							handleMouseLeaveChartKeyLabel($(this));
																						});

				newToggleDownloads.append(newCheckbox)
									.append(newCheckboxLabel)
									.append(newCheckboxLabelVisible);

				$('.js-combined-chart-container .js-custom-chart-key ul').append(newToggle);
				$('.js-combined-chart-container .js-custom-chart-key ul').append(newToggleDownloads);
			}

			function removeASeriesToggle(seriesIndex) {

				// remove from the twin chart legend
				var toggleToRemove = $('.js-twin-chart-container .js-custom-chart-key input[data-series-index="' + seriesIndex + '"').parent("li");
				toggleToRemove.remove();

				// remove from the combined chart legend
				var combinedSeriesIndex = seriesIndex * 2;
				var toggleToRemove = $('.js-combined-chart-container .js-custom-chart-key input[data-series-index="' + combinedSeriesIndex + '"').parent("li");
				toggleToRemove.remove();

				var combinedSeriesIndexTwo = seriesIndex * 2 + 1;
				var toggleToRemove = $('.js-combined-chart-container .js-custom-chart-key input[data-series-index="' + combinedSeriesIndexTwo + '"').parent("li");
				toggleToRemove.remove();

				// recalculate the toggle data series indexes
				$('.js-twin-chart-container .js-custom-chart-key input').each(function(){
					var thisSeriesIndex = $(this).attr("data-series-index");		
					if(thisSeriesIndex > seriesIndex) {
						$(this).attr("data-series-index", thisSeriesIndex - 1);
					}
				});

				// recalculate the toggle data series indexes
				$('.js-combined-chart-container .js-custom-chart-key input').each(function(){
					var thisSeriesIndex = $(this).attr("data-series-index");	
					if($(this).attr("data-series-index") >= seriesIndex * 3) {
						$(this).attr("data-series-index", thisSeriesIndex - 2);
					}
				});

				// remove from colours in use array				
				usedSeriesColours.splice(seriesIndex, 1);
			}

			// Generate Demo Charts
			var mockDataRevenue = [],
					mockDataDownloads = [];

			var seriesColours = ["#f5c943", "#beb9db", "#fd7f6e", "#7fb1d5", "#f2bdd8", "#c7b299", "#bd7ebf", "#8bd4c7", "#ffb55a", "#d9d9d9", "#918edf"];

			var seriesFills = ["rgba(245,201,67,0)", "rgba(190,185,219,1)", "rgba(253,127,110,1)", "rgba(127,177,213,1)", "rgba(242,189,216,1)", "rgba(199,178,153,1)", "rgba(189,126,191,1)", "rgba(139,212,199,1)", "rgba(255,181,90,1)", "rgba(217,217,217,1)", "rgba(145,142,223,1)"];

			var seriesAppIcons = [
				{ 
					icon: "images/demo-icon-clash-of-hamsters.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-clash-of-hamsters.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-angry-hamsters.jpg",
					store: "play-store"
				},
				{ 
					icon: "images/demo-icon-five-hamsters-at-freddies.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-crossy-hamster.jpg",
					store: "play-store"
				},
				{ 
					icon: "images/demo-icon-hamster-crush.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-hamsters-vs-zombies.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-hamster-ninja.jpg",
					store: "play-store"
				},
				{ 
					icon: "images/demo-icon-8-ball-hamster.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-flappy-hamster.jpg",
					store: "ios"
				},
				{ 
					icon: "images/demo-icon-geometry-hamster.jpg",
					store: "ios"
				}
			];
			
			var usedSeriesColours = [];

			setTimeout(function() {

				// CREATE MOCK DATA FOR CHART
				// chartData var comes from external js/data-vis/data-vis-release.js
				
					// MOCK REVENUE DATA
				mockDataRevenue.push([]); // mock only, first item in array placeholder for totals calculated later
				usedSeriesColours.push(seriesColours[0]);

				for(var s = 0; s < 4; s++) {
					var mockSeries = [];
					for(var d = 0; d < 12; d++) {						
						if(chartData[s].data[d]) {
							mockSeries.push(chartData[s].data[d].value);
						} else {
							mockSeries.push(30000);
						}
					}
					mockDataRevenue.push(mockSeries);
					usedSeriesColours.push(seriesColours[s + 1]);
				}				

				var mockSeriesTotal = []; // MOCK TOTAL COMES BY ADDING UP REST OF THE DATA - TEMPLATE ONLY
				for(var d = 0; d < 12; d++) {
					var totalOfSeriesForDataPoint = 0;
					for(var s = 1; s < 5; s++) {
						if(mockDataRevenue[s][d] != null) {
							totalOfSeriesForDataPoint = totalOfSeriesForDataPoint + parseInt(mockDataRevenue[s][d]);
						}						
					}
					mockSeriesTotal.push(totalOfSeriesForDataPoint);
				}
				mockDataRevenue[0] = mockSeriesTotal; // TOTAL IS THE FIRST LINE ON THE GRAPH

					// MOCK DOWNLOADS DATA
				mockDataDownloads.push([]);
				for(var s = 5; s < 9; s++) {
					var mockSeries = [];
					for(var d = 0; d < 12; d++) {
						if(chartData[s].data[d]) {
							mockSeries.push(chartData[s].data[d].value);
						} else {
							mockSeries.push(1);
						}
					}
					mockDataDownloads.push(mockSeries);
				}

				var mockSeriesTotal = []; // MOCK TOTAL COMES BY ADDING UP REST OF THE DATA - TEMPLATE ONLY
				for(var d = 0; d < 12; d++) {
					var totalOfSeriesForDataPoint = 0;
					for(var s = 1; s < 5; s++) {
						if(mockDataDownloads[s][d] != null) {
							totalOfSeriesForDataPoint = totalOfSeriesForDataPoint + parseInt(mockDataDownloads[s][d]);
						}
					}
					mockSeriesTotal.push(totalOfSeriesForDataPoint);
				}
				mockDataDownloads[0] = mockSeriesTotal;


				revAndDownData = new Array(); 				
				revAndDownData.push(mockDataRevenue);
				revAndDownData.push(mockDataDownloads);				

				generateChart('chart-revenue', "revenueseries", mockDataRevenue, seriesColours, "area", false);
				generateChart('chart-downloads', "downloadsseries", mockDataDownloads, seriesColours, "area", false);
				generateChart('chart-combined', "split", revAndDownData, seriesColours, "area", true);
				$('.chart-container').addClass('is-animated');
				handleChartInteraction();

				addAppDataToSeries();
				Highcharts.Chart.prototype.setFirstVisibleSeriesToSelected();
				Highcharts.Chart.prototype.setGraphCSSClasses();
        Highcharts.Chart.prototype.resetLineStyling();
			}, 500);
			
			setTimeout(function(){
				$('.js-alert-urgent').addClass("is-open");
			}, 1000);

			mockCountryPicker();
  	}

  	function mockCountryPicker() {
  		// MOCK COUNTRY SELECTOR
			$('.js-group-trigger').on("click", function(){ // to open the country selector
				var $this = $(this),
						thisPositionTop = $this.offset().top,
						thisPositionLeft = $this.offset().left,
						thisHeight = $this.innerHeight(),
						thisWidth = $this.innerWidth(),
						offsetTop = 10,
						isAlreadyOpen = $this.parent('.js-form-field--group').hasClass("is-open"),
						groupPickerWidth = 650;
				
				if(!isAlreadyOpen) {
					setTimeout(function(){ // setTimeout is to wait for all other popups to close first
						
						$('.js-group-picker').show().css({ "top" : thisPositionTop + thisHeight + offsetTop, "left" : thisPositionLeft});
						$this.parent(".js-form-field--group").addClass("is-open");
						
					}, 100);
				} else {
					$this.parent(".js-form-field--group").addClass("is-open");
				}
			});

			$('.js-mock-group-picker-apply').on("click", function(e){
				e.preventDefault();
				$('.js-group-picker').hide();
				$('.js-group-trigger').parent(".is-open").removeClass("is-open");
				var numberOfCountriesValue = $('.js-mock-picker-number-selected').text();
				var countryText = "Overlaid Countries (" + numberOfCountriesValue + ")";
				$('.js-group-trigger').text(countryText);
			});

			$('.js-mock-toggle-group-selectors').on("click", function(){ // this is the popular, regions, countries and my groups toggle
				var contentIdToShow = $(this).data("show");
				$('.js-group-selector-container').hide();
				$('#' + contentIdToShow).show();
				if(contentIdToShow == "group-selector-container--popular") {
					synchCheckboxesWithCurrentSelection();
					unselectRadioGroupsSelection();
					toggleAmendGroupForm(true);
				} else {
					unselectRadioGroupsSelection();
					toggleAmendGroupForm(true);
				}
			});

			function setNumberSelected() {
				var numberSelected = $('.js-group-picker__selections .group-picker__selection').length;
	  		$('.js-mock-picker-number-selected').text(numberSelected);

	  		if(numberSelected > 0) {
	  			toggleSaveToGroupsLink(false);
	  		} else {
	  			toggleSaveToGroupsLink(true);
	  		}
			}
			
			function closeCreateGroupContainer() {
				if($createGroupForm.hasClass("is-showing")) {
					$createGroupFormCancel.show();
					$createGroupForm.removeClass("is-showing");
					$createGroupFormApply.removeClass("is-success is-disabled").text("Create Group");	
				}				
			}

			function synchCheckboxesWithCurrentSelection() {
				
				// for instance, if a user goes from my groups to popular, selections need to synch
				$('.js-mock-group-item-results input:checked').each(function(){
					$(this)[0].checked = false;
				});
				
				$('.js-group-picker__selections .group-picker__remove-group-link').each(function(){
					var idOfCheckboxToTurnOn = $(this).attr("for");
					$('#' + idOfCheckboxToTurnOn)[0].checked = true;
				});
			}

			function unselectRadioGroupsSelection() {
				$('.js-mock-group-results input:checked').each(function(){
					$(this)[0].checked = false;
				});				
			}

			function toggleSaveToGroupsLink(isHide) {
				if(isHide) {
					$saveToGroupsLink.css("display", "none");
				} else {
					$saveToGroupsLink.css("display", "block");
				}
			}

			function toggleAmendGroupForm(isHide) {
				if(isHide) {
					$('.js-amend-group-form').hide();
				} else {
					$('.js-amend-group-form').show();
				}
			}

			function showSaveIfRadioGroupSelected() {
				var isAGroupSelected = false;
				$('.js-mock-group-results input').each(function(){
					if($(this)[0].checked == true) {
						isAGroupSelected = true;						
					}
					if(isAGroupSelected) {
						toggleAmendGroupForm(false);
					} else {
						toggleAmendGroupForm(true);
					}
				});
			}

			var $createGroupForm = $('.js-create-group-form'),
					$createGroupFormApply = $('.js-mock-create-group-apply'),
					$createGroupFormCancel = $('.js-mock-create-group-cancel'),
					$saveToGroupsLink = $('.js-mock-save-to-groups-link');

					// popular countries list item checkbox change
	  	$('.js-mock-group-item-results input[type=checkbox]').on("change", function() {
	  		var selectionContainer = $('.js-group-picker__selections'),
	  				$this = $(this),
	  				selectedLabel = $this.siblings(".checkboxLabelVisible"),
	  				selectedText = selectedLabel.find("span").text(),
	  				selectedFlag = selectedLabel.find(".icon-flag-sm").attr("class"),
	  				selectedCheckboxId = $this.attr("id");
	  				closeCreateGroupContainer();

	  		if($this[0].checked == true) {
	  			var newSelection = $("<div>").addClass("group-picker__selection")
	  																		.attr("id", "picker-id-" + selectedCheckboxId)
	  																		.append($("<div>").addClass(selectedFlag))
	  																		.append($("<span>").text(selectedText))
	  																		.append($("<label>").addClass("group-picker__remove-group-link ref-icon-after--close js-remove-selected-group js-no-close-on-click")
	  																										.attr("for", selectedCheckboxId)
	  																										.text("Clear")
	  																										.on("click", function(){
	  																											$(this).parent(".group-picker__selection").remove();
	  																											closeCreateGroupContainer();
	  																										})
	  																						);

					selectionContainer.append(newSelection);

	  		} else {
	  			selectionContainer.find("#picker-id-" + selectedCheckboxId).remove();
	  		}

	  		setNumberSelected();

	  		$('.js-mock-group-picker-apply').removeClass('is-disabled');
	  	});

				// My groups radio button change
			$('.js-mock-group-results input[type=radio]').on("change", function() {
	  		var selectionContainer = $('.js-group-picker__selections'),
	  				$this = $(this),
	  				selectedCheckboxId = $this.attr("id");
	  				closeCreateGroupContainer();

	  				selectionContainer.empty();
	  				$('.js-mock-picker-number-selected').text("0");
	  				toggleAmendGroupForm(true);

	  				// Add Mock Data to results
	  				if(selectedCheckboxId == "radioButtonOne") {
	  					// fill country selection with mock results (as if it were a saved group)
		  				var ukSelection = $("<div>").addClass("group-picker__selection")
		  																		.attr("id", "picker-id-checkboxCountryUK")
		  																		.append($("<div>").addClass("icon-flag-sm icon-flag--GB"))
		  																		.append($("<span>").text("United Kingdom"))
		  																		.append($("<label>").addClass("group-picker__remove-group-link ref-icon-after--close js-remove-selected-group js-no-close-on-click")
		  																										.attr("for", "checkboxCountryUK")
		  																										.text("Clear")
		  																										.on("click", function(){
		  																											$(this).parent(".group-picker__selection").remove();
		  																											closeCreateGroupContainer();
		  																											showSaveIfRadioGroupSelected();
		  																										})
		  																						);

		  				var germanySelection = $("<div>").addClass("group-picker__selection")
		  																		.attr("id", "picker-id-checkboxCountryIt")
		  																		.append($("<div>").addClass("icon-flag-sm icon-flag--DE"))
		  																		.append($("<span>").text("Germany"))
		  																		.append($("<label>").addClass("group-picker__remove-group-link ref-icon-after--close js-remove-selected-group js-no-close-on-click")
		  																										.attr("for", "checkboxCountryIt")
		  																										.text("Clear")
		  																										.on("click", function(){
		  																											$(this).parent(".group-picker__selection").remove();
		  																											closeCreateGroupContainer();
		  																											showSaveIfRadioGroupSelected();
		  																										})
		  																						);

							selectionContainer.append(ukSelection);
							selectionContainer.append(germanySelection);
	  				} else {
	  					// fill country selection with mock results (as if it were a saved group)
		  				var franceSelection = $("<div>").addClass("group-picker__selection")
		  																		.attr("id", "picker-id-checkboxCountryFr")
		  																		.append($("<div>").addClass("icon-flag-sm icon-flag--FR"))
		  																		.append($("<span>").text("France"))
		  																		.append($("<label>").addClass("group-picker__remove-group-link ref-icon-after--close js-remove-selected-group js-no-close-on-click")
		  																										.attr("for", "checkboxCountryFr")
		  																										.text("Clear")
		  																										.on("click", function(){
		  																											$(this).parent(".group-picker__selection").remove();
		  																											closeCreateGroupContainer();
		  																											showSaveIfRadioGroupSelected();
		  																										})
		  																						);

		  				var germanySelection = $("<div>").addClass("group-picker__selection")
		  																		.attr("id", "picker-id-checkboxCountryIt")
		  																		.append($("<div>").addClass("icon-flag-sm icon-flag--DE"))
		  																		.append($("<span>").text("Germany"))
		  																		.append($("<label>").addClass("group-picker__remove-group-link ref-icon-after--close js-remove-selected-group js-no-close-on-click")
		  																										.attr("for", "checkboxCountryIt")
		  																										.text("Clear")
		  																										.on("click", function(){
		  																											$(this).parent(".group-picker__selection").remove();
		  																											closeCreateGroupContainer();
		  																											showSaveIfRadioGroupSelected();
		  																										})
		  																						);
		  				var usaSelection = $("<div>").addClass("group-picker__selection")
		  																		.attr("id", "picker-id-checkboxCountryUSA")
		  																		.append($("<div>").addClass("icon-flag-sm icon-flag--US"))
		  																		.append($("<span>").text("USA"))
		  																		.append($("<label>").addClass("group-picker__remove-group-link ref-icon-after--close js-remove-selected-group js-no-close-on-click")
		  																										.attr("for", "checkboxCountryUSA")
		  																										.text("Clear")
		  																										.on("click", function(){
		  																											$(this).parent(".group-picker__selection").remove();
		  																											closeCreateGroupContainer();
		  																											showSaveIfRadioGroupSelected();
		  																										})
		  																						);

							selectionContainer.append(franceSelection);
							selectionContainer.append(germanySelection);
							selectionContainer.append(usaSelection);
	  				}

	  				setNumberSelected();	  				
	  				synchCheckboxesWithCurrentSelection();
	  				toggleSaveToGroupsLink(true);
	  				$('.js-mock-group-picker-apply').removeClass("is-disabled");
	  	});

			$saveToGroupsLink.on("click", function(){
				$(this).hide();
				$createGroupForm.addClass("is-showing");
				$('.js-amend-group-form').hide();
				$createGroupForm.find("input[type=text]").focus();
			});

			$createGroupFormCancel.on("click", function(){
				$saveToGroupsLink.css("display", "block");
				$createGroupForm.removeClass("is-showing");

				showSaveIfRadioGroupSelected()
			});			

			$createGroupFormApply.on("click", function(){
				$createGroupFormApply.addClass("is-success is-disabled").text("Group Created!");
				$createGroupFormCancel.hide();
				unselectRadioGroupsSelection();

				// mock add to my groups
				var nameForNewGroup = $('.js-create-group-form input[type=text]').val();
				if(nameForNewGroup.length == 0) {
					nameForNewGroup = "New Group";
				}
				var mockListItem = $('<li><input type="radio" name="radioButtons" id="radioButtonNew"><label for="radioButtonNew" class="radioButtonLabel">' + nameForNewGroup + '</label><label for="radioButtonNew" class="radioButtonLabelVisible">' + nameForNewGroup + '</label><span class="group-selector__remove-group-icon ref-icon-after--close js-remove-group js-no-close-on-click"></span></li>'); // Obviously add this element in a better way, just for mock!!

				$('.js-mock-group-results').append(mockListItem);
					
			});
			
			$('.js-mock-clear-selected-countries').on("click", function(){
				unselectRadioGroupsSelection();
				showSaveIfRadioGroupSelected();
				$('.js-group-picker__selections').find(".js-remove-selected-group").trigger("click");
				closeCreateGroupContainer();
			});

			$('.js-remove-group').on("click", function(){
				$(this).parents("li").remove();
			});

			// end country picker
  	}

  	window.onready = initScripts();
  </script>
</body>